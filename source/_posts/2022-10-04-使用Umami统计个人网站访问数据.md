---
title: Umamiç»Ÿè®¡ä¸ªäººç½‘ç«™è®¿é—®æ•°æ®
date: 2022-10-04 12:42:34
tags: 
  - æ•´æ´»
  - ç™½å«–
categories: æ£é¼“
abbrlink: umami
description: äºNetlifyéƒ¨ç½²Umami
aplayer: true
---

{% meting "1985399394" "netease" "song" "mutex:false" "volume:0.5" "listmaxheight:340px"%}

## å…³äº Umami

Umami æ˜¯ä¸€ä¸ªå¼€æºçš„ã€ä»¥éšç§ä¸ºä¸­å¿ƒçš„ Google Analytics æ›¿ä»£æ–¹æ¡ˆã€‚Umami æä¾›å¼ºå¤§çš„ç½‘ç»œåˆ†æè§£å†³æ–¹æ¡ˆï¼Œä¸ä¼šä¾µçŠ¯ç”¨æˆ·éšç§ã€‚æ­¤å¤–ï¼Œå½“è‡ªè¡Œæ‰˜ç®¡ Umami æ—¶ï¼Œå¯ä»¥å®Œå…¨æ§åˆ¶è‡ªå·±çš„æ•°æ®ã€‚

æŸ¥çœ‹ Umami åŠŸèƒ½ç¤ºä¾‹ï¼šğŸ”—[Live Demo](https://app.umami.is/share/8rmHaheU/umami.is) ã€‚

## å¦‚ä½•æ­å»º

æœ¬æ–‡ä½¿ç”¨ Serverless å¹³å°æ¥æ­å»º Umamiï¼Œåº”ç”¨éƒ¨ç½²åœ¨ [Netlify](https://www.netlify.com/)ï¼Œæ•°æ®åº“ä½¿ç”¨ [Supabase](https://app.supabase.com/)ï¼Œå…¶ä»–å¹³å°å‚è§ [å®˜ç½‘æ–‡æ¡£](https://umami.is/docs)

### æ•°æ®åº“

[Supabase](https://app.supabase.com/) æ˜¯ä¸€ä¸ªå…¼å®¹ `PostgreSQL` çš„æ— æœåŠ¡å™¨æ•°æ®åº“å¹³å°ã€‚ 

å…¶ä»–æ•°æ®åº“å‚è§å®˜ç½‘æ–‡æ¡£ [Hosting](https://umami.is/docs/hosting) `Managed databases` éƒ¨åˆ†ã€‚

1. ç™»å½• Supabase å¹¶åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œåå­—å‡å¦‚ä¸º umami ã€‚æ³¨æ„ï¼Œåˆ›å»ºæ—¶ä¼šè®©ä½ è¾“å…¥`Database Password`ï¼Œå¤åˆ¶ä¸‹æ¥ä¿å­˜ç€ï¼Œç­‰ä¸‹è¦ç”¨ã€‚`Region`æŒ‡çš„æ˜¯æ•°æ®åº“åœ°å€ï¼Œå°½é‡é€‰ç¾å›½(US)ï¼Œå› ä¸ºç¦»NetlifyæœåŠ¡å™¨æ¯”è¾ƒè¿‘ï¼ˆçŒœçš„:Dï¼‰
   
   ![](https://cdn.jsdelivr.net/gh/wefoox/pic/2022/10/04/10-55-28.webp)

2. è·å–è¿æ¥å­—ç¬¦ä¸²ï¼ˆä¾§è¾¹æ `setting`->`Database`->æ»‘å€’ä¸‹é¢çš„`Connection Pooling`ï¼‰->å¤åˆ¶`Connection String`
   
   å¹¶æŠŠå¤åˆ¶çš„`Database Password`ä»£æ›¿`[YOUR-PASSWORD]`
   
   **æ³¨æ„ï¼šä½ éœ€è¦åœ¨è¿™æ®µå­—ç¬¦ä¸²åé¢å¢åŠ ä¸€ä¸ª`?pgbouncer=true`**
   
   ç°åœ¨ä½ çš„`Connetion String`åº”è¯¥**ç±»ä¼¼äº**è¿™æ ·çš„
   
   ```textile
   postgres://postgres:[YOUR-PASSWORD]@db.eepnqjajbammmqbefgua.supabase.co:6543/postgres?pgbouncer=true
   ```
   
   ![](https://cdn.jsdelivr.net/gh/wefoox/pic/2022/10/04/10-59-42.webp)

3. å›åˆ°ä¸»é¡µï¼Œæˆ‘ä»¬åˆå§‹åŒ–æ•°æ®åº“ã€‚è¿›å…¥ä¾§è¾¹æ `SQL Editor`->`New Query`ï¼Œå¤åˆ¶ä»¥ä¸‹ä»£ç å¹¶è¿è¡Œ
   
   ```sql
   CREATE SCHEMA IF NOT EXISTS "auth";
   CREATE SCHEMA IF NOT EXISTS "extensions";
   create extension if not exists "uuid-ossp"      with schema extensions;
   create extension if not exists pgcrypto         with schema extensions;
   create extension if not exists pgjwt            with schema extensions;
   
   grant usage on schema public to postgres, anon, authenticated, service_role;
   grant usage on schema extensions to postgres, anon, authenticated, service_role;
   alter user supabase_admin SET search_path TO public, extensions; -- don't include the "auth" schema
   
   grant all privileges on all tables in schema public to postgres, anon, authenticated, service_role, supabase_admin;
   grant all privileges on all functions in schema public to postgres, anon, authenticated, service_role, supabase_admin;
   grant all privileges on all sequences in schema public to postgres, anon, authenticated, service_role, supabase_admin;
   
   alter default privileges in schema public grant all on tables to postgres, anon, authenticated, service_role;
   alter default privileges in schema public grant all on functions to postgres, anon, authenticated, service_role;
   alter default privileges in schema public grant all on sequences to postgres, anon, authenticated, service_role;
   
   alter default privileges for user supabase_admin in schema public grant all on sequences to postgres, anon, authenticated, service_role;
   alter default privileges for user supabase_admin in schema public grant all on tables to postgres, anon, authenticated, service_role;
   alter default privileges for user supabase_admin in schema public grant all on functions to postgres, anon, authenticated, service_role;
   
   alter role anon set statement_timeout = '3s';
   alter role authenticated set statement_timeout = '8s';
   
   -- ä¸Šé¢çš„ä»£ç ä½œç”¨æ˜¯èµ‹äºˆæ•°æ®åº“ç¼–è¾‘æƒé™ï¼Œè¦ä¸ç„¶ä¹‹åéƒ¨ç½²çš„æ—¶å€™ä¼šæŠ¥é”™(è¡€æ³ªçš„æ•™è®­æƒ¹)
   
   -- CreateTable
   CREATE TABLE "account" (
       "user_id" SERIAL NOT NULL,
       "username" VARCHAR(255) NOT NULL,
       "password" VARCHAR(60) NOT NULL,
       "is_admin" BOOLEAN NOT NULL DEFAULT false,
       "created_at" TIMESTAMPTZ(6) DEFAULT CURRENT_TIMESTAMP,
       "updated_at" TIMESTAMPTZ(6) DEFAULT CURRENT_TIMESTAMP,
   
       PRIMARY KEY ("user_id")
   );
   
   -- CreateTable
   CREATE TABLE "event" (
       "event_id" SERIAL NOT NULL,
       "website_id" INTEGER NOT NULL,
       "session_id" INTEGER NOT NULL,
       "created_at" TIMESTAMPTZ(6) DEFAULT CURRENT_TIMESTAMP,
       "url" VARCHAR(500) NOT NULL,
       "event_type" VARCHAR(50) NOT NULL,
       "event_value" VARCHAR(50) NOT NULL,
   
       PRIMARY KEY ("event_id")
   );
   
   -- CreateTable
   CREATE TABLE "pageview" (
       "view_id" SERIAL NOT NULL,
       "website_id" INTEGER NOT NULL,
       "session_id" INTEGER NOT NULL,
       "created_at" TIMESTAMPTZ(6) DEFAULT CURRENT_TIMESTAMP,
       "url" VARCHAR(500) NOT NULL,
       "referrer" VARCHAR(500),
   
       PRIMARY KEY ("view_id")
   );
   
   -- CreateTable
   CREATE TABLE "session" (
       "session_id" SERIAL NOT NULL,
       "session_uuid" UUID NOT NULL,
       "website_id" INTEGER NOT NULL,
       "created_at" TIMESTAMPTZ(6) DEFAULT CURRENT_TIMESTAMP,
       "hostname" VARCHAR(100),
       "browser" VARCHAR(20),
       "os" VARCHAR(20),
       "device" VARCHAR(20),
       "screen" VARCHAR(11),
       "language" VARCHAR(35),
       "country" CHAR(2),
   
       PRIMARY KEY ("session_id")
   );
   
   -- CreateTable
   CREATE TABLE "website" (
       "website_id" SERIAL NOT NULL,
       "website_uuid" UUID NOT NULL,
       "user_id" INTEGER NOT NULL,
       "name" VARCHAR(100) NOT NULL,
       "domain" VARCHAR(500),
       "share_id" VARCHAR(64),
       "created_at" TIMESTAMPTZ(6) DEFAULT CURRENT_TIMESTAMP,
   
       PRIMARY KEY ("website_id")
   );
   
   -- CreateIndex
   CREATE UNIQUE INDEX "account.username_unique" ON "account"("username");
   
   -- CreateIndex
   CREATE INDEX "event_created_at_idx" ON "event"("created_at");
   
   -- CreateIndex
   CREATE INDEX "event_session_id_idx" ON "event"("session_id");
   
   -- CreateIndex
   CREATE INDEX "event_website_id_idx" ON "event"("website_id");
   
   -- CreateIndex
   CREATE INDEX "pageview_created_at_idx" ON "pageview"("created_at");
   
   -- CreateIndex
   CREATE INDEX "pageview_session_id_idx" ON "pageview"("session_id");
   
   -- CreateIndex
   CREATE INDEX "pageview_website_id_created_at_idx" ON "pageview"("website_id", "created_at");
   
   -- CreateIndex
   CREATE INDEX "pageview_website_id_idx" ON "pageview"("website_id");
   
   -- CreateIndex
   CREATE INDEX "pageview_website_id_session_id_created_at_idx" ON "pageview"("website_id", "session_id", "created_at");
   
   -- CreateIndex
   CREATE UNIQUE INDEX "session.session_uuid_unique" ON "session"("session_uuid");
   
   -- CreateIndex
   CREATE INDEX "session_created_at_idx" ON "session"("created_at");
   
   -- CreateIndex
   CREATE INDEX "session_website_id_idx" ON "session"("website_id");
   
   -- CreateIndex
   CREATE UNIQUE INDEX "website.website_uuid_unique" ON "website"("website_uuid");
   
   -- CreateIndex
   CREATE UNIQUE INDEX "website.share_id_unique" ON "website"("share_id");
   
   -- CreateIndex
   CREATE INDEX "website_user_id_idx" ON "website"("user_id");
   
   -- AddForeignKey
   ALTER TABLE "event" ADD FOREIGN KEY ("session_id") REFERENCES "session"("session_id") ON DELETE CASCADE ON UPDATE CASCADE;
   
   -- AddForeignKey
   ALTER TABLE "event" ADD FOREIGN KEY ("website_id") REFERENCES "website"("website_id") ON DELETE CASCADE ON UPDATE CASCADE;
   
   -- AddForeignKey
   ALTER TABLE "pageview" ADD FOREIGN KEY ("session_id") REFERENCES "session"("session_id") ON DELETE CASCADE ON UPDATE CASCADE;
   
   -- AddForeignKey
   ALTER TABLE "pageview" ADD FOREIGN KEY ("website_id") REFERENCES "website"("website_id") ON DELETE CASCADE ON UPDATE CASCADE;
   
   -- AddForeignKey
   ALTER TABLE "session" ADD FOREIGN KEY ("website_id") REFERENCES "website"("website_id") ON DELETE CASCADE ON UPDATE CASCADE;
   
   -- AddForeignKey
   ALTER TABLE "website" ADD FOREIGN KEY ("user_id") REFERENCES "account"("user_id") ON DELETE CASCADE ON UPDATE CASCADE;
   
   -- CreateAdminUser
   INSERT INTO account (username, password, is_admin) values ('admin', '$2b$10$BUli0c.muyCW1ErNJc3jL.vFRFtFJWrT8/GcR4A.sUdCznaXiqFXa', true);
   
   ALTER TABLE account OWNER TO postgres;
   ALTER TABLE website OWNER TO postgres;
   ALTER TABLE session OWNER TO postgres;
   ALTER TABLE pageview OWNER TO postgres;
   ALTER TABLE event OWNER TO postgres;
   ```
   
   ![](https://cdn.jsdelivr.net/gh/wefoox/pic/2022/10/04/11-15-07.webp)
   
   ç‚¹`Run`åæ˜¾ç¤º`Success. No rows returned`åº”è¯¥å°±æˆäº†ã€‚æ‰“å¼€ä¾§è¾¹æ `Table editor`åº”è¯¥å¯ä»¥çœ‹åˆ°é‡Œé¢å¤šå‡ºæ¥äº†5æ¡æ•°æ®
   
   ![](https://cdn.jsdelivr.net/gh/wefoox/pic/2022/10/04/11-24-05.webp)

### Netlify

æ­¤æ—¶æ•°æ®åº“å·²ç»åˆå§‹åŒ–å®Œæ¯•ï¼Œæ¥ä¸‹æ¥å°†åº”ç”¨éƒ¨ç½²åœ¨ Netlify ä¸Šã€‚

- [ç‚¹å‡»ä¸€é”®éƒ¨ç½²](https://app.netlify.com/start/deploy?repository=https://github.com/umami-software/umami)

- æˆ–è€…æ‰‹åŠ¨éƒ¨ç½²
  
   - Fork Umami çš„ä»“åº“: [https://github.com/umami-software/umami](https://github.com/umami-software/umami) åˆ°è‡ªå·±çš„ GitHub
  
   - æ³¨å†Œä¸€ä¸ª Netlify å¸æˆ·å¹¶ç™»å½•ï¼ˆå·²æœ‰è·³è¿‡ï¼‰ã€‚
  
   - ä» GitHub ä¸Šå¯¼å…¥é¡¹ç›®ã€‚
  
   - æ·»åŠ æ‰€éœ€çš„ç¯å¢ƒå˜é‡ `DATABASE_URL` å’Œ `HASH_SALT`ï¼ˆéšæœºå­—ç¬¦ä¸²ï¼‰ä»¥åŠ `TRACKER_SCRIPT_NAME`ï¼ˆ`DATABASE_URL` å°±æ˜¯ä½ åˆšåˆšç¼–è¾‘è¿‡çš„æ•°æ®åº“é“¾æ¥ï¼Œ`HASH_SALT` éšä¾¿å¡«ï¼Œ`TRACKER_SCRIPT_NAME` æ˜¯æŒ‡æ’ä»¶è„šæœ¬åç§°ï¼Œç”±äºé»˜è®¤çš„umami.jså®¹æ˜“è¢«æµè§ˆå™¨æ’ä»¶å±è”½ï¼Œæ•…åœ¨æ­¤è‡ªå®šä¹‰è„šæœ¬åç§°ï¼‰
  
   - é¿å…è¢«æ’ä»¶æ‹¦æˆª
     
     > ä½¿ç”¨å¤–æŒ‚ JS çš„æ–¹å¼æ¥ç»Ÿè®¡æ•°æ®ï¼Œè™½ç„¶å¯ä»¥ç»Ÿè®¡çœŸå®çš„è®¿å®¢è®°å½•ï¼Œä½†æ˜¯ä¼šè¢« uBlockÂ æ­¤ç±»çš„å¹¿å‘Šæ‹¦æˆªæ’ä»¶ç»™ç›´æ¥æ‹¦æˆªæ‰ï¼Œä»¥è‡³äºæ— æ³•å‡†ç¡®çš„è·å–è®¿å®¢æ•°æ®ã€‚
     
     è¿™é‡Œæœ‰å¤§ä½¬å·²ç»ç»™å‡ºäº†æ–¹æ¡ˆï¼Œå‚è€ƒ[è§£å†³ Umami ç»Ÿè®¡è„šæœ¬è¢«æ‹¦æˆªå¹¿å‘Šæ’ä»¶æ‹¦æˆª - ROYWANG](https://roy.wang/umami-js-name/)
* ç‚¹å‡»éƒ¨ç½²æŒ‰é’®ï¼Œç„¶åå¯ä»¥è®¿é—® `<deploy-id>.netlify.app` æŸ¥çœ‹æ•ˆæœã€‚

* åç»­å¯ä»¥åœ¨ `Site Settings` -> `Build & Deploy`-> `Environment variables` ç¼–è¾‘ç¯å¢ƒå˜é‡ï¼Œéœ€è¦é‡æ–°éƒ¨ç½²æœåŠ¡ç”Ÿæ•ˆ

## å¦‚ä½•ä½¿ç”¨

### æ¥å…¥ç½‘ç«™

- é…ç½®å®Œæˆç½‘ç«™åæ‰“å¼€ï¼Œä½¿ç”¨åˆå§‹ç”¨æˆ·åå¯†ç ç™»å½• admin:umamiã€‚ç™»å½•å®Œæˆåå¯åœ¨å³ä¸Šè§’ä¸ªäººèµ„æ–™ï¼Œæ›´æ–°å¯†ç å¤„ä¿®æ”¹é»˜è®¤ä¿¡æ¯ã€‚æ¥ç€ä¸ªäººèµ„æ–™ï¼Œç½‘ç«™ï¼Œæ·»åŠ ç½‘å€å¤„æ¥å…¥å¾…ç»Ÿè®¡çš„ç½‘ç«™ï¼Œå¦‚æœå‹¾é€‰äº†å¯ç”¨å…±äº«é“¾æ¥ï¼Œä»£è¡¨å¯ä»¥å°†è¯¥ç½‘ç«™çš„ç»Ÿè®¡æ•°æ®åˆ†äº«ç»™ä»–äººæŸ¥çœ‹ã€‚

- æ·»åŠ ç½‘ç«™åï¼Œåœ¨ç½‘ç«™åˆ—è¡¨çš„è·å–è·Ÿè¸ªä»£ç æŒ‰é’®å¤„ç‚¹å‡»ï¼Œå¤åˆ¶å…·ä½“å†…å®¹åˆ°æ ‡ç­¾ä¸­ï¼Œæ³¨ï¼šå¦‚æœå¼€å¯äº†è‡ªå®šä¹‰è„šæœ¬åç§°ï¼Œæ­¤å¤„çš„é“¾æ¥æ–‡ä»¶éœ€è¦æ‰‹åŠ¨æ›¿æ¢ã€‚

### è·Ÿè¸ªäº‹ä»¶

> Umami çš„è‡ªå®šä¹‰è·Ÿè¸ªäº‹ä»¶æœ‰äº›é¸¡è‚‹ï¼Œåªèƒ½åšåˆ°ç»Ÿè®¡æ•°é‡ã€‚æ”¯æŒä¸¤ç±»ï¼šä¸€æ˜¯ CSS ç±»ï¼Œä¹Ÿå°±æ˜¯ `umami--<event>--<event-name>` æ‰“æ ‡æ–¹å¼ï¼›å¦ä¸€ç§æ˜¯åœ¨åŠ è½½å®Œæˆ Umami æ–‡ä»¶åï¼Œæä¾›äº† umami å¯¹è±¡ï¼Œå¯ä»¥è°ƒç”¨ä¸€äº›æ–¹æ³•ï¼Œä¸¤ç§æ–¹å¼å…¶å®éƒ½æŒºå‹‰å¼ºã€‚

è¯¦æƒ…è§å®˜ç½‘æ–‡æ¡£ï¼š[https://umami.is/docs/track-events](https://umami.is/docs/track-events)

### åœ¨ hexo ä¸­ä½¿ç”¨

å¦‚æœä¸»é¢˜æ²¡æœ‰é€‚é… umami çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ [hexo injector](https://hexo.io/zh-cn/api/injector) ç›´æ¥æ³¨å…¥ï¼Œhexo ç‰ˆæœ¬éœ€è¦å¤§äº 5

åœ¨ä½ çš„ç½‘ç«™æ ¹ç›®å½•ä¸‹çš„ `Scripts` æ–‡ä»¶å¤¹ä¸‹ï¼ˆæ„£ç€å¹²å˜›ï¼Œæ²¡æœ‰æ–°å»ºå•Šï¼‰ï¼Œæ–°å»ºä¸€ä¸ª `umami.js` æ–‡ä»¶ï¼Œå¤åˆ¶ä»¥ä¸‹ä»£ç è¿›å»ä¿å­˜å³å¯ã€‚

è‡ªè¡Œæ›¿æ¢æ‰å…¶ä¸­çš„ `<your-website-id>` ä¸ `<your-umami-url>` ï¼Œä½ å¯ä»¥åœ¨umamiæ§åˆ¶å°è®¾ç½®ä¸­æ·»åŠ ç½‘ç«™æ‰¾åˆ°ä¸¤æ®µä»£ç 

![](https://cdn.jsdelivr.net/gh/wefoox/pic/2022/10/04/11-44-02.webp)

```js
hexo.extend.injector.register('head_end', '<script async defer data-website-id="<your-website-id>" src="<your-umami-url>"></script>');
```

å†æ¬¡ `hexo g` & `hexo d` é‡ç°æ‰“å¼€ä½ çš„ç½‘ç«™ï¼ŒF12æ‰“å¼€æ§åˆ¶å°ï¼Œå‡ºç° `<TRACKER_SCRIPT_NAME>.js` å³ä¸ºå¼•ç”¨æˆåŠŸ

![](https://cdn.jsdelivr.net/gh/wefoox/pic/2022/10/04/11-38-21.webp)

## ä¸€äº›é¢˜å¤–è¯

### ä¸ºå•¥æˆ‘ä¸ç”¨Vercelï¼Ÿ

å…¶å®å¹¶ä¸æ˜¯æ²¡æœ‰å°è¯•è¿‡ä½¿ç”¨vercelï¼Œåªæ˜¯ä¸çŸ¥é“ä¸ºå•¥verceléƒ¨ç½²å®Œæˆåç™»å½•çš„æ—¶å€™loginä¼šæŠ¥Error 500çš„é”™è¯¯ï¼Œç„¶åå¡åœ¨ç™»é™†ç•Œé¢æ²¡æœ‰ååº”ï¼Œæ²¡å¼„æ¸…æ¥šï¼ŒNetlifyå°±æ²¡æœ‰é—®é¢˜

### ä¸ºä»€ä¹ˆSupabaseä¸ç”¨Connection infoé‡Œé¢çš„é“¾æ¥å‘¢ï¼Ÿ

å› ä¸ºç­‰ä¼šå„¿éƒ¨ç½²çš„æ—¶å€™å®ƒä¼šæŠ¥é”™è¿ä¸ä¸ŠDatebaseï¼Œä¸è¦å‚è€ƒå®˜æ–¹æ–‡æ¡£ä¸­çš„æ ‡å‡†é“¾æ¥ï¼Œä¸è¿‡è²Œä¼¼åœ¨æˆ‘å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™å¥½åƒå®˜æ–¹æ–‡æ¡£å·²ç»æ”¹è¿‡æ¥äº† [umami - Running on Supabase](https://umami.is/docs/running-on-supabase) 

### ä¸ºä»€ä¹ˆä½ çš„åˆå§‹åŒ–æ•°æ®åº“ä»£ç ä¸[å®˜æ–¹](https://github.com/umami-software/umami/blob/master/sql/schema.postgresql.sql)çš„ä¸ä¸€æ ·ï¼Ÿ

<details>

<summary>å› ä¸ºä¼šæŠ¥Error: P3018(issueé‡Œé¢å¥½åƒè¯´æ˜¯æ²¡æœ‰è¯»å†™æƒé™ï¼Ÿ)</summary>

```
[01:50:57.036] Running "vercel build"
[01:50:57.538] Vercel CLI 28.4.4
[01:50:57.884] Installing dependencies...
[01:50:58.232] yarn install v1.22.17
[01:50:58.314] [1/4] Resolving packages...
[01:50:58.629] [2/4] Fetching packages...
[01:51:19.971] [3/4] Linking dependencies...
[01:51:19.974] warning " > next-basics@0.7.0" has incorrect peer dependency "react@^18.2.0".
[01:51:19.974] warning " > next-basics@0.7.0" has incorrect peer dependency "react-dom@^18.2.0".
[01:51:19.975] warning "react-spring > @react-spring/konva@9.5.2" has unmet peer dependency "konva@>=2.6".
[01:51:19.975] warning "react-spring > @react-spring/konva@9.5.2" has unmet peer dependency "react-konva@^16.8.0  || ^17.0.0".
[01:51:19.976] warning "react-spring > @react-spring/native@9.5.2" has unmet peer dependency "react-native@>=0.58".
[01:51:19.976] warning "react-spring > @react-spring/three@9.5.2" has unmet peer dependency "@react-three/fiber@>=6.0".
[01:51:19.976] warning "react-spring > @react-spring/three@9.5.2" has unmet peer dependency "three@>=0.126".
[01:51:19.976] warning "react-spring > @react-spring/zdog@9.5.2" has unmet peer dependency "react-zdog@>=1.0".
[01:51:19.978] warning "react-spring > @react-spring/zdog@9.5.2" has unmet peer dependency "zdog@>=1.0".
[01:51:19.985] warning "eslint-config-next > @typescript-eslint/parser > @typescript-eslint/typescript-estree > tsutils@3.21.0" has unmet peer dependency "typescript@>=2.8.0 || >= 3.2.0-dev || >= 3.3.0-dev || >= 3.4.0-dev || >= 3.5.0-dev || >= 3.6.0-dev || >= 3.6.0-beta || >= 3.7.0-dev || >= 3.7.0-beta".
[01:51:39.133] [4/4] Building fresh packages...
[01:51:46.252] $ prisma generate || true
[01:51:48.580] prisma:warn The postinstall script automatically ran `prisma generate` and did not find your `prisma/schema.prisma`.
[01:51:48.581] If you have a Prisma schema file in a custom path, you will need to run
[01:51:48.581] `prisma generate --schema=./path/to/your/schema.prisma` to generate Prisma Client.
[01:51:48.581] If you do not have a Prisma schema file yet, you can ignore this message.
[01:51:48.581] 
[01:51:49.386] $ node -e "if (process.env.NODE_ENV !== 'production'){process.exit(1)} " || husky install
[01:51:49.495] husky - Git hooks installed
[01:51:49.498] Done in 51.27s.
[01:51:49.534] Detected Next.js version: 12.2.5
[01:51:49.536] Running "yarn run build"
[01:51:49.805] yarn run v1.22.17
[01:51:49.849] $ npm-run-all build-db check-db build-tracker build-geo build-app
[01:51:50.293] $ npm-run-all copy-db-files build-db-client
[01:51:50.733] $ node scripts/copy-db-files.js
[01:51:50.867] Database type detected: postgresql
[01:51:50.876] Copied /vercel/path0/db/postgresql to /vercel/path0/prisma
[01:51:51.223] $ prisma generate
[01:51:53.170] Prisma schema loaded from prisma/schema.prisma
[01:51:54.575] 
[01:51:54.575] âœ” Generated Prisma Client (4.3.1 | library) to ./node_modules/@prisma/client in 215ms
[01:51:54.576] You can now start using Prisma Client in your code. Reference: https://pris.ly/d/client
[01:51:54.576] ```
[01:51:54.576] import { PrismaClient } from '@prisma/client'
[01:51:54.576] const prisma = new PrismaClient()
[01:51:54.576] ```
[01:51:54.716] â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
[01:51:54.716] â”‚  Update available 4.3.1 -> 4.4.0                        â”‚
[01:51:54.717] â”‚  Run the following to update                            â”‚
[01:51:54.717] â”‚    yarn add --dev prisma@latest                         â”‚
[01:51:54.717] â”‚    yarn add @prisma/client@latest                       â”‚
[01:51:54.717] â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
[01:51:55.090] $ node scripts/check-db.js
[01:51:55.226] âœ“ DATABASE_URL is defined.
[01:51:56.406] âœ“ Database connection successful.
[01:51:57.801] âœ“ Database tables found.
[01:52:02.783] Prisma schema loaded from prisma/schema.prisma
[01:52:02.783] Datasource "db": PostgreSQL database "postgres", schema "public" at "db.wdwzdvdykslszebhocqx.supabase.co:5432"
[01:52:02.783] 
[01:52:02.783] 3 migrations found in prisma/migrations
[01:52:02.783] 
[01:52:02.783] Following migrations have not yet been applied:
[01:52:02.783] 01_init
[01:52:02.783] 02_add_event_data
[01:52:02.783] 03_remove_casade_delete
[01:52:02.783] 
[01:52:02.784] To apply migrations in development run yarn prisma migrate dev.
[01:52:02.784] To apply migrations in production run yarn prisma migrate deploy.
[01:52:02.784] 
[01:52:02.784] Running update...
[01:52:08.475] Prisma schema loaded from prisma/schema.prisma
[01:52:08.475] Datasource "db": PostgreSQL database "postgres", schema "public" at "db.wdwzdvdykslszebhocqx.supabase.co:5432"
[01:52:08.475] Migration 01_init marked as applied.
[01:52:08.475] 
[01:52:16.565] Error: P3018
[01:52:16.565] 
[01:52:16.566] A migration failed to apply. New migrations cannot be applied before the error is recovered from. Read more about how to resolve migration issues in a production database: https://pris.ly/d/migrate-resolve
[01:52:16.566] 
[01:52:16.566] Migration name: 02_add_event_data
[01:52:16.566] 
[01:52:16.566] Database error code: 42501
[01:52:16.567] 
[01:52:16.567] Database error:
[01:52:16.567] ERROR: must be owner of table event
[01:52:16.568] 
[01:52:16.568] DbError { severity: "ERROR", parsed_severity: Some(Error), code: SqlState(E42501), message: "must be owner of table event", detail: None, hint: None, position: None, where_: None, schema: None, table: None, column: None, datatype: None, constraint: None, file: Some("aclchk.c"), line: Some(3583), routine: Some("aclcheck_error") }
[01:52:16.568] 
[01:52:16.568] 
[01:52:16.568] âœ— Command failed: prisma migrate deploy
[01:52:16.569] Error: P3018
[01:52:16.569] 
[01:52:16.569] A migration failed to apply. New migrations cannot be applied before the error is recovered from. Read more about how to resolve migration issues in a production database: https://pris.ly/d/migrate-resolve
[01:52:16.569] 
[01:52:16.569] Migration name: 02_add_event_data
[01:52:16.569] 
[01:52:16.569] Database error code: 42501
[01:52:16.569] 
[01:52:16.569] Database error:
[01:52:16.569] ERROR: must be owner of table event
[01:52:16.569] 
[01:52:16.569] DbError { severity: "ERROR", parsed_severity: Some(Error), code: SqlState(E42501), message: "must be owner of table event", detail: None, hint: None, position: None, where_: None, schema: None, table: None, column: None, datatype: None, constraint: None, file: Some("aclchk.c"), line: Some(3583), routine: Some("aclcheck_error") }
[01:52:16.570] 
[01:52:16.570] 
[01:52:16.570] 
[01:52:16.583] error Command failed with exit code 1.
[01:52:16.583] info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
[01:52:16.598] ERROR: "check-db" exited with 1.
[01:52:16.611] error Command failed with exit code 1.
[01:52:16.611] info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
[01:52:16.632] Error: Command "yarn run build" exited with 1
```

</details>

å¯ä»¥å‚è€ƒä¸€ä¸‹issue: 

https://github.com/umami-software/umami/issues/1525

https://github.com/umami-software/umami/discussions/1486#discussioncomment-3567397)

### è¿˜æœ‰å…¶ä»–çš„æ•°æ®åº“å¯ä»¥éƒ¨ç½²å—ï¼Ÿ

å½“ç„¶æœ‰ï¼Œæ¯”å¦‚[PlanetScale](https://planetscale.com/)ï¼Œåªæ˜¯ä¸çŸ¥é“ä¸ºå•¥åŒæ ·ä¹Ÿæ˜¯ä¸€ç›´æŠ¥é”™ï¼Œæ²¡ææ‡‚ï¼Œè¯»è€…å¯ä»¥è‡ªè¡Œæ‘¸ç´¢
