---
title: OneDrive
tags:
  - 技术
categories:
  - 捣鼓
abbrlink: ondrive
date: 2022-05-19 00:44:37
---

> 你的仓库正在沦为肉鸡
>
> 由于 Github 漏洞，[攻击者可通过 Pull Request 运行挖矿程序](https://logi.im/go/aHR0cHM6Ly93d3cuZnJlZWJ1Zi5jb20vYXJ0aWNsZXMvcGFwZXIvMjY4ODI5Lmh0bWw=)，请删除原先 Fork 的代码，选择 [导入私有仓库](https://logi.im/go/aHR0cHM6Ly9kb2NzLmdpdGh1Yi5jb20vY24vZ2l0aHViL2ltcG9ydGluZy15b3VyLXByb2plY3RzLXRvLWdpdGh1Yi9pbXBvcnRpbmctYS1yZXBvc2l0b3J5LXdpdGgtZ2l0aHViLWltcG9ydGVy) 再运行 Action。

> 续订成功通知
>
> ![](https://image.baidu.com/search/down?tn=download&url=https://tva2.sinaimg.cn/large/006DZngIgy1gzj01pww7oj30gj0bldih.jpg)

`Office 365 E5` 是微软 **免费** 提供给开发者的 Office 临时管理号，任何人均可申请。该账号的最大权益便是可分配 25 个子账号，每个账号都拥有 `OneDrive 5T 存储` 和完整的 `Office 客户端` 使用权。

首次申请，可免费使用 90 天。到期后，根据微软机制，借助 Github Action 或 Tencent Servless 等平台的虚拟环境和定时任务功能，可实现 永久自动续期。

Office E5开发者账号申请步骤
========

打开 [申请链接](https://logi.im/go/aHR0cHM6Ly9kZXZlbG9wZXIubWljcm9zb2Z0LmNvbS9vZmZpY2UvcHJvZmlsZQ==)，`登录` 你的微软账户。如未注册过，点击图中的创建一个，在此不再赘述。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12096694967/0)

登录成功进入信息填写页面后，选择 `国家`，随意填写 `公司` 名称，勾选 `接受条款` 后，点击 `下一步`。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12099533891/0)

进入个性化体验页面后，`随意勾选` 几个必选项，点击 `加入`。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/14241020505/0.png)

进入下个页面后，点击 `设置 E5 订阅`。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12096775126/0)

在弹出的对话框中填写 `国家`、`用户名`、`域` 和 `密码` 后，点击 `继续`，注意在记事本 `保存你的密码`。

域即 `网址前缀`，填写后可能提示 `已被使用`，改用 `其他字母` 即可。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12096799759/0)

接着会要求绑定 `手机号`，由于网站使用了 `谷歌` 人机验证，因此需要**科学上网**。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/14241026089/0.png)

收到 `验证码` 后，填入对话框，点击 `设置`。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12096853407/0)

`等待一分钟` 左右，页面将显示订阅成功。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12096869353/0)

开始使用
========

打开 [Office 官网](https://logi.im/go/aHR0cHM6Ly93d3cub2ZmaWNlLmNvbS8%7CYXV0aD0y)，使用上图中的 `管理员账号` 和第五张图设置的 `密码` 登录。关闭向导后，点击页面中的 OneDrive 和 Word 图标等，即可使用 `网页端` 服务。如需使用 `客户端`，点击右上角的 `安装 Office - Office 365 应用`，使用下载的安装器，跟随步骤安装即可。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12096924747/0)

扩展空间
========

订阅号默认的 OneDrive 空间是 1T，可在管理页扩展为 5T。打开 [OneDrive 存储管理页](https://logi.im/go/aHR0cHM6Ly9hZG1pbi5vbmVkcml2ZS5jb20vP3Y9U3RvcmFnZVNldHRpbmdz)，`登录` 申请的管理号，将空间设置为 `5120` 后点击 `保存`。如页面 `无法加载`，则系统尚未完成初始化，`等待 24 小时` 后重新打开。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/14241029283/0.png)

子号分配
========

管理员可分配 25 个子号，每个账号都可使用 Office 365 并拥有 5T OneDrive 空间。点击页面中的 `管理` 按钮，进入管理员中心。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12096959440/0)

点击左侧菜单栏的 `用户 - 活跃用户`，点击右侧的 `添加用户`，

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/14241032659/0.png)

在弹出的选项卡中，填写 `必要信息` 后，点击 `下一步`。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/14241032660/0.png)

在接下来的三个步骤中，全部 `保持默认选项`，直接点击 `下一步`，最后 `关闭` 选项卡。

Github Action
========

<div class="info">

    > 微软的账号续订策略也算是一种玄学了，只能说要保持活跃就大概率能续上，一般微软会在账号到期前30天和你发封邮件告诉你续订成功，要是没有收到邮件就有点危险了

</div>



订阅的有效期是 `90` 天。到期前，如果微软检测到账号被用于开发，即 `API 被频繁且无规律调用`，将自动续期。因此，只需编写几行代码，定时高频调用其 API 即可。

`Github Action` 是 Github 提供给开发者使用的 `虚拟 Linux 环境`，可 `根据条件`，例如指定时间，`执行指定代码`。

## 添加任务

首先 [登录或注册](https://logi.im/go/aHR0cHM6Ly9naXRodWIuY29tLw==) 一个 Github 账号，在此不再赘述。~随后打开 [该仓库](https://logi.im/go/aHR0cHM6Ly9naXRodWIuY29tL3ZjaGVja3plbi9BdXRvQXBpU2VjcmV0)，点击右上角的 `Fork`~（会遭到攻击，想收藏可以 Star，禁止 Fork）。随后[导入私有仓库](https://logi.im/go/aHR0cHM6Ly9kb2NzLmdpdGh1Yi5jb20vY24vZ2l0aHViL2ltcG9ydGluZy15b3VyLXByb2plY3RzLXRvLWdpdGh1Yi9pbXBvcnRpbmctYS1yZXBvc2l0b3J5LXdpdGgtZ2l0aHViLWltcG9ydGVy)，在 `Your old repository’s clone URL` 里填写

```
*   https://github.com/vcheckzen/KeepAliveE5.git 
```

Privacy 务必选择 `Private`。

点击 `Begin Import`，稍等片刻，你的账号下便会复制一份该项目。

现在，创建一个具有 `workflow` 权限的个人访问密钥，用于同步上流代码。首先访问 [密钥创建页面](https://logi.im/go/aHR0cHM6Ly9naXRodWIuY29tL3NldHRpbmdzL3Rva2Vucy9uZXc=)，按照下图填写信息，随后将页面拉到最下方，点击绿色的 `Generate token` 按钮。

![](https://image.baidu.com/search/down?tn=download&url=https://img30.360buyimg.com/pop/jfs/t1/206051/13/12358/57553/6175299eEfe259c2b/a508c13c89a05d96.png)

接着，页面会跳转到创建成功页面，点击图中的 `复制` 图标，复制生成的 PAT 密钥备用。

![](https://image.baidu.com/search/down?tn=download&url=https://img30.360buyimg.com/pop/jfs/t1/214960/8/1710/21605/61752a54E0ea98893/1a7b13a656fe0f75.png)

现在只需为仓库添加下表中的三个密钥，具体过程请查看上方视频（视频中未添加 PAT，你要自己加上）

|  Name  |                          Value                          |
| :----: | :-----------------------------------------------------: |
|  PAT   |       Github 个人访问密钥，需要具有 workflow 权限       |
|  USER  |    E5 管理员邮箱（支持多个，每行一个，不要填写子号）    |
| PASSWD | E5 管理员密码（支持多个，每行一个，顺序必须和邮箱一致） |

现在按照 [链接](https://logi.im/go/aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vemgtY24vYXp1cmUvYWN0aXZlLWRpcmVjdG9yeS9mdW5kYW1lbnRhbHMvY29uY2VwdC1mdW5kYW1lbnRhbHMtc2VjdXJpdHktZGVmYXVsdHMjZGlzYWJsaW5nLXNlY3VyaXR5LWRlZmF1bHRz) 说明，关闭 E5 管理员账号的 `两步验证（多因素认证、安全默认值）`。

一定要按照链接里的 1-5 步**关闭两步验证**（多因素认证、安全默认值），否则无法注册成功，进而无法调用 API。

现在转到 `Action` 面板，在 `All workflows` 下找到 `Register APP`，手动触发它完成注册流程，2 分钟左右。如果确认一切操作正确仍然 `Register` 失败，可等待 10-30min 后再操作，因为关闭安全默认值后，微软系统要过一段时间才会刷新。

如果 `Action` 面板找不到 `Register APP`，则修改 `.github/workflows` 目录下的两个文件，随便添加一行注释保存，详细过程见上方视频。如果 `Action` 面板不显示，则到仓库的 `Settings -> Actions -> Actions permissions` 勾选 `Allow all actions` 后保存，具体参考 [该链接](https://logi.im/go/aHR0cHM6Ly9kb2NzLmdpdGh1Yi5jb20vZW4vcmVwb3NpdG9yaWVzL21hbmFnaW5nLXlvdXItcmVwb3NpdG9yeXMtc2V0dGluZ3MtYW5kLWZlYXR1cmVzL2VuYWJsaW5nLWZlYXR1cmVzLWZvci15b3VyLXJlcG9zaXRvcnkvbWFuYWdpbmctZ2l0aHViLWFjdGlvbnMtc2V0dGluZ3MtZm9yLWEtcmVwb3NpdG9yeSNtYW5hZ2luZy1naXRodWItYWN0aW9ucy1wZXJtaXNzaW9ucy1mb3IteW91ci1yZXBvc2l0b3J5)。部分用户账号由于之前跑其它违规项目被封禁 Action 功能的，自行注册新账号。

务必确保运行日志如下图一样包含成功字样，否则必须按照提示解决问题后再重新启动注册动作，直到注册成功。

## 应用注册成功

![](https://image.baidu.com/search/down?tn=download&url=https://p3-tt.byteimg.com/origin/pgc-image/452212730e3e4661b318c968c8db2f10.png)

## API 调用成功

![](https://image.baidu.com/search/down?tn=download&url=https://p3-tt.byteimg.com/origin/pgc-image/75f67d9a19214550aeb2e0f0e9c255af.png)

再找到 `Invoke API` 手动触发它看能否成功调用 API。如无错误，任务会定时执行，基本可保证续订成功。

# [E5 Renew Plus](https://e5renew.com/)

除了以上用Github Action续订的方法之外，还有一种 E5 调用API续订服务，即[E5 Renew Plus](https://e5renew.com/)，你可以在其官方网站找到Windows版本，按照官方的步骤来，就没有问题

但是，我就是想续订一下，还得每天打开这个软件放后台挂着，那多麻烦呐。别急，现在我们介绍[Microsoft 365 E5 Renew X](https://blog.csdn.net/qq_33212020/article/details/119747634)

Microsoft 365 E5 Renew X是一款网页版的E5续订服务，其依赖网页浏览器呈现支持用户多端操作，完全将E5账户[API](https://so.csdn.net/so/search?q=API&spm=1001.2101.3001.7020)调用托管在了服务器端因此用户无需电脑也可使用。

直接看文章：[E5 调用API续订服务：Microsoft 365 E5 Renew X](https://blog.csdn.net/qq_33212020/article/details/119747634)

#  OneDrive 搭建个人网盘

这是一个简短的构建你自己的 onedrive-vercel-index 的指导。

1.  Fork [此项目](https://github.com/spencerwooo/onedrive-vercel-index)。
2.  将 `site.config.js` 里的 `userPrincipleName` 改为你的微软账户邮箱。
3.  将 `site.config.js` 里的 `baseDirectory` 修改为你要分享的文件夹路径。
4.  根据你的 OneDrive 版本示情况修改 `api.config.js`。
5.  将你的项目导入到 Vercel 并 [添加 Upstash 插件](https://vercel.com/integrations/upstash) 以更方便地设置 `REDIS_URL` 环境变量。
6.  部署，并享受！ 🎉

部署完成后的项目会引导你进行 OAuth 步骤，并自动将所需的凭证存储到 Redis 数据库里。这就是我们要做的全部事情！

更加详细的步骤在官方文档中[onedrive-vercel-index](https://github.com/spencerwooo/onedrive-vercel-index): > [Getting started](https://ovi.swo.moe/docs/getting-started)

不仅仅是可以搭建onedrive-vercel-index

也有很多优秀的项目可以白嫖（不是

- [OneManager-php](https://github.com/qkqpttgf/OneManager-php)
- [alist](https://github.com/alist-org/alist)
- [PanIndex](https://github.com/libsgh/PanIndex)

以及其他等等优秀的项目都能够挂载Onedrive、阿里云盘、天翼云盘......

> 文章出处：
> [Office 365 E5 账号申请及永久续期教程 - LOGI](https://logi.im/script/permanently-keeping-an-office-e5-account.html)
> [E5 调用API续订服务：Microsoft 365 E5 Renew X](https://blog.csdn.net/qq_33212020/article/details/119747634)
> [onedrive-vercel-index](https://github.com/spencerwooo/onedrive-vercel-index): > [Getting started](https://ovi.swo.moe/docs/getting-started)