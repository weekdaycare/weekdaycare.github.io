---
title: OneDrive
tags:
  - æŠ€æœ¯
categories:
  - æ£é¼“
abbrlink: ondrive
date: 2022-05-19 00:44:37
---

> ä½ çš„ä»“åº“æ­£åœ¨æ²¦ä¸ºè‚‰é¸¡
>
> ç”±äº Github æ¼æ´ï¼Œ[æ”»å‡»è€…å¯é€šè¿‡ Pull Request è¿è¡ŒæŒ–çŸ¿ç¨‹åº](https://logi.im/go/aHR0cHM6Ly93d3cuZnJlZWJ1Zi5jb20vYXJ0aWNsZXMvcGFwZXIvMjY4ODI5Lmh0bWw=)ï¼Œè¯·åˆ é™¤åŸå…ˆ Fork çš„ä»£ç ï¼Œé€‰æ‹© [å¯¼å…¥ç§æœ‰ä»“åº“](https://logi.im/go/aHR0cHM6Ly9kb2NzLmdpdGh1Yi5jb20vY24vZ2l0aHViL2ltcG9ydGluZy15b3VyLXByb2plY3RzLXRvLWdpdGh1Yi9pbXBvcnRpbmctYS1yZXBvc2l0b3J5LXdpdGgtZ2l0aHViLWltcG9ydGVy) å†è¿è¡Œ Actionã€‚

> ç»­è®¢æˆåŠŸé€šçŸ¥
>
> ![](https://image.baidu.com/search/down?tn=download&url=https://tva2.sinaimg.cn/large/006DZngIgy1gzj01pww7oj30gj0bldih.jpg)

`Office 365 E5` æ˜¯å¾®è½¯ **å…è´¹** æä¾›ç»™å¼€å‘è€…çš„ Office ä¸´æ—¶ç®¡ç†å·ï¼Œä»»ä½•äººå‡å¯ç”³è¯·ã€‚è¯¥è´¦å·çš„æœ€å¤§æƒç›Šä¾¿æ˜¯å¯åˆ†é… 25 ä¸ªå­è´¦å·ï¼Œæ¯ä¸ªè´¦å·éƒ½æ‹¥æœ‰ `OneDrive 5T å­˜å‚¨` å’Œå®Œæ•´çš„ `Office å®¢æˆ·ç«¯` ä½¿ç”¨æƒã€‚

é¦–æ¬¡ç”³è¯·ï¼Œå¯å…è´¹ä½¿ç”¨ 90 å¤©ã€‚åˆ°æœŸåï¼Œæ ¹æ®å¾®è½¯æœºåˆ¶ï¼Œå€ŸåŠ© Github Action æˆ– Tencent Servless ç­‰å¹³å°çš„è™šæ‹Ÿç¯å¢ƒå’Œå®šæ—¶ä»»åŠ¡åŠŸèƒ½ï¼Œå¯å®ç° æ°¸ä¹…è‡ªåŠ¨ç»­æœŸã€‚

Office E5å¼€å‘è€…è´¦å·ç”³è¯·æ­¥éª¤
========

æ‰“å¼€ [ç”³è¯·é“¾æ¥](https://logi.im/go/aHR0cHM6Ly9kZXZlbG9wZXIubWljcm9zb2Z0LmNvbS9vZmZpY2UvcHJvZmlsZQ==)ï¼Œ`ç™»å½•` ä½ çš„å¾®è½¯è´¦æˆ·ã€‚å¦‚æœªæ³¨å†Œè¿‡ï¼Œç‚¹å‡»å›¾ä¸­çš„åˆ›å»ºä¸€ä¸ªï¼Œåœ¨æ­¤ä¸å†èµ˜è¿°ã€‚

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12096694967/0)

ç™»å½•æˆåŠŸè¿›å…¥ä¿¡æ¯å¡«å†™é¡µé¢åï¼Œé€‰æ‹© `å›½å®¶`ï¼Œéšæ„å¡«å†™ `å…¬å¸` åç§°ï¼Œå‹¾é€‰ `æ¥å—æ¡æ¬¾` åï¼Œç‚¹å‡» `ä¸‹ä¸€æ­¥`ã€‚

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12099533891/0)

è¿›å…¥ä¸ªæ€§åŒ–ä½“éªŒé¡µé¢åï¼Œ`éšæ„å‹¾é€‰` å‡ ä¸ªå¿…é€‰é¡¹ï¼Œç‚¹å‡» `åŠ å…¥`ã€‚

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/14241020505/0.png)

è¿›å…¥ä¸‹ä¸ªé¡µé¢åï¼Œç‚¹å‡» `è®¾ç½® E5 è®¢é˜…`ã€‚

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12096775126/0)

åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­å¡«å†™ `å›½å®¶`ã€`ç”¨æˆ·å`ã€`åŸŸ` å’Œ `å¯†ç ` åï¼Œç‚¹å‡» `ç»§ç»­`ï¼Œæ³¨æ„åœ¨è®°äº‹æœ¬ `ä¿å­˜ä½ çš„å¯†ç `ã€‚

åŸŸå³ `ç½‘å€å‰ç¼€`ï¼Œå¡«å†™åå¯èƒ½æç¤º `å·²è¢«ä½¿ç”¨`ï¼Œæ”¹ç”¨ `å…¶ä»–å­—æ¯` å³å¯ã€‚

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12096799759/0)

æ¥ç€ä¼šè¦æ±‚ç»‘å®š `æ‰‹æœºå·`ï¼Œç”±äºç½‘ç«™ä½¿ç”¨äº† `è°·æ­Œ` äººæœºéªŒè¯ï¼Œå› æ­¤éœ€è¦ç§‘å­¦ä¸Šç½‘ã€‚

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/14241026089/0.png)

æ”¶åˆ° `éªŒè¯ç ` åï¼Œå¡«å…¥å¯¹è¯æ¡†ï¼Œç‚¹å‡» `è®¾ç½®`ã€‚

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12096853407/0)

`ç­‰å¾…ä¸€åˆ†é’Ÿ` å·¦å³ï¼Œé¡µé¢å°†æ˜¾ç¤ºè®¢é˜…æˆåŠŸã€‚

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12096869353/0)

å¼€å§‹ä½¿ç”¨
========

æ‰“å¼€ [Office å®˜ç½‘](https://logi.im/go/aHR0cHM6Ly93d3cub2ZmaWNlLmNvbS8%7CYXV0aD0y)ï¼Œä½¿ç”¨ä¸Šå›¾ä¸­çš„ `ç®¡ç†å‘˜è´¦å·` å’Œç¬¬äº”å¼ å›¾è®¾ç½®çš„ `å¯†ç ` ç™»å½•ã€‚å…³é—­å‘å¯¼åï¼Œç‚¹å‡»é¡µé¢ä¸­çš„ OneDrive å’Œ Word å›¾æ ‡ç­‰ï¼Œå³å¯ä½¿ç”¨ `ç½‘é¡µç«¯` æœåŠ¡ã€‚å¦‚éœ€ä½¿ç”¨ `å®¢æˆ·ç«¯`ï¼Œç‚¹å‡»å³ä¸Šè§’çš„ `å®‰è£… Office - Office 365 åº”ç”¨`ï¼Œä½¿ç”¨ä¸‹è½½çš„å®‰è£…å™¨ï¼Œè·Ÿéšæ­¥éª¤å®‰è£…å³å¯ã€‚

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12096924747/0)

æ‰©å±•ç©ºé—´
========

è®¢é˜…å·é»˜è®¤çš„ OneDrive ç©ºé—´æ˜¯ 1Tï¼Œå¯åœ¨ç®¡ç†é¡µæ‰©å±•ä¸º 5Tã€‚æ‰“å¼€ [OneDrive å­˜å‚¨ç®¡ç†é¡µ](https://logi.im/go/aHR0cHM6Ly9hZG1pbi5vbmVkcml2ZS5jb20vP3Y9U3RvcmFnZVNldHRpbmdz)ï¼Œ`ç™»å½•` ç”³è¯·çš„ç®¡ç†å·ï¼Œå°†ç©ºé—´è®¾ç½®ä¸º `5120` åç‚¹å‡» `ä¿å­˜`ã€‚å¦‚é¡µé¢ `æ— æ³•åŠ è½½`ï¼Œåˆ™ç³»ç»Ÿå°šæœªå®Œæˆåˆå§‹åŒ–ï¼Œ`ç­‰å¾… 24 å°æ—¶` åé‡æ–°æ‰“å¼€ã€‚

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/14241029283/0.png)

å­å·åˆ†é…
========

ç®¡ç†å‘˜å¯åˆ†é… 25 ä¸ªå­å·ï¼Œæ¯ä¸ªè´¦å·éƒ½å¯ä½¿ç”¨ Office 365 å¹¶æ‹¥æœ‰ 5T OneDrive ç©ºé—´ã€‚ç‚¹å‡»é¡µé¢ä¸­çš„ `ç®¡ç†` æŒ‰é’®ï¼Œè¿›å…¥ç®¡ç†å‘˜ä¸­å¿ƒã€‚

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12096959440/0)

ç‚¹å‡»å·¦ä¾§èœå•æ çš„ `ç”¨æˆ· - æ´»è·ƒç”¨æˆ·`ï¼Œç‚¹å‡»å³ä¾§çš„ `æ·»åŠ ç”¨æˆ·`ï¼Œ

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/14241032659/0.png)

åœ¨å¼¹å‡ºçš„é€‰é¡¹å¡ä¸­ï¼Œå¡«å†™ `å¿…è¦ä¿¡æ¯` åï¼Œç‚¹å‡» `ä¸‹ä¸€æ­¥`ã€‚

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/14241032660/0.png)

åœ¨æ¥ä¸‹æ¥çš„ä¸‰ä¸ªæ­¥éª¤ä¸­ï¼Œå…¨éƒ¨ `ä¿æŒé»˜è®¤é€‰é¡¹`ï¼Œç›´æ¥ç‚¹å‡» `ä¸‹ä¸€æ­¥`ï¼Œæœ€å `å…³é—­` é€‰é¡¹å¡ã€‚

è‡ªåŠ¨ç»­æœŸ
========

è®¢é˜…çš„æœ‰æ•ˆæœŸæ˜¯ `90` å¤©ã€‚åˆ°æœŸå‰ï¼Œå¦‚æœå¾®è½¯æ£€æµ‹åˆ°è´¦å·è¢«ç”¨äºå¼€å‘ï¼Œå³ `API è¢«é¢‘ç¹ä¸”æ— è§„å¾‹è°ƒç”¨`ï¼Œå°†è‡ªåŠ¨ç»­æœŸã€‚å› æ­¤ï¼Œåªéœ€ç¼–å†™å‡ è¡Œä»£ç ï¼Œå®šæ—¶é«˜é¢‘è°ƒç”¨å…¶ API å³å¯ã€‚

`Github Action` æ˜¯ Github æä¾›ç»™å¼€å‘è€…ä½¿ç”¨çš„ `è™šæ‹Ÿ Linux ç¯å¢ƒ`ï¼Œå¯ `æ ¹æ®æ¡ä»¶`ï¼Œä¾‹å¦‚æŒ‡å®šæ—¶é—´ï¼Œ`æ‰§è¡ŒæŒ‡å®šä»£ç `ã€‚

## æ·»åŠ ä»»åŠ¡

é¦–å…ˆ [ç™»å½•æˆ–æ³¨å†Œ](https://logi.im/go/aHR0cHM6Ly9naXRodWIuY29tLw==) ä¸€ä¸ª Github è´¦å·ï¼Œåœ¨æ­¤ä¸å†èµ˜è¿°ã€‚~éšåæ‰“å¼€ [è¯¥ä»“åº“](https://logi.im/go/aHR0cHM6Ly9naXRodWIuY29tL3ZjaGVja3plbi9BdXRvQXBpU2VjcmV0)ï¼Œç‚¹å‡»å³ä¸Šè§’çš„ `Fork`~ï¼ˆä¼šé­åˆ°æ”»å‡»ï¼Œæƒ³æ”¶è—å¯ä»¥ Starï¼Œç¦æ­¢ Forkï¼‰ã€‚éšå[å¯¼å…¥ç§æœ‰ä»“åº“](https://logi.im/go/aHR0cHM6Ly9kb2NzLmdpdGh1Yi5jb20vY24vZ2l0aHViL2ltcG9ydGluZy15b3VyLXByb2plY3RzLXRvLWdpdGh1Yi9pbXBvcnRpbmctYS1yZXBvc2l0b3J5LXdpdGgtZ2l0aHViLWltcG9ydGVy)ï¼Œåœ¨ `Your old repositoryâ€™s clone URL` é‡Œå¡«å†™

```
*   https://github.com/vcheckzen/KeepAliveE5.git 
```

Privacy åŠ¡å¿…é€‰æ‹© `Private`ã€‚

ç‚¹å‡» `Begin Import`ï¼Œç¨ç­‰ç‰‡åˆ»ï¼Œä½ çš„è´¦å·ä¸‹ä¾¿ä¼šå¤åˆ¶ä¸€ä»½è¯¥é¡¹ç›®ã€‚

ç°åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªå…·æœ‰ `workflow` æƒé™çš„ä¸ªäººè®¿é—®å¯†é’¥ï¼Œç”¨äºåŒæ­¥ä¸Šæµä»£ç ã€‚é¦–å…ˆè®¿é—® [å¯†é’¥åˆ›å»ºé¡µé¢](https://logi.im/go/aHR0cHM6Ly9naXRodWIuY29tL3NldHRpbmdzL3Rva2Vucy9uZXc=)ï¼ŒæŒ‰ç…§ä¸‹å›¾å¡«å†™ä¿¡æ¯ï¼Œéšåå°†é¡µé¢æ‹‰åˆ°æœ€ä¸‹æ–¹ï¼Œç‚¹å‡»ç»¿è‰²çš„ `Generate token` æŒ‰é’®ã€‚

![](https://image.baidu.com/search/down?tn=download&url=https://img30.360buyimg.com/pop/jfs/t1/206051/13/12358/57553/6175299eEfe259c2b/a508c13c89a05d96.png)

æ¥ç€ï¼Œé¡µé¢ä¼šè·³è½¬åˆ°åˆ›å»ºæˆåŠŸé¡µé¢ï¼Œç‚¹å‡»å›¾ä¸­çš„ `å¤åˆ¶` å›¾æ ‡ï¼Œå¤åˆ¶ç”Ÿæˆçš„ PAT å¯†é’¥å¤‡ç”¨ã€‚

![](https://image.baidu.com/search/down?tn=download&url=https://img30.360buyimg.com/pop/jfs/t1/214960/8/1710/21605/61752a54E0ea98893/1a7b13a656fe0f75.png)

ç°åœ¨åªéœ€ä¸ºä»“åº“æ·»åŠ ä¸‹è¡¨ä¸­çš„ä¸‰ä¸ªå¯†é’¥ï¼Œå…·ä½“è¿‡ç¨‹è¯·æŸ¥çœ‹ä¸Šæ–¹è§†é¢‘ï¼ˆè§†é¢‘ä¸­æœªæ·»åŠ  PATï¼Œä½ è¦è‡ªå·±åŠ ä¸Šï¼‰

| Name   | Value                                                   |
| ------ | ------------------------------------------------------- |
| PAT    | Github ä¸ªäººè®¿é—®å¯†é’¥ï¼Œéœ€è¦å…·æœ‰ workflow æƒé™             |
| USER   | E5 ç®¡ç†å‘˜é‚®ç®±ï¼ˆæ”¯æŒå¤šä¸ªï¼Œæ¯è¡Œä¸€ä¸ªï¼Œä¸è¦å¡«å†™å­å·ï¼‰       |
| PASSWD | E5 ç®¡ç†å‘˜å¯†ç ï¼ˆæ”¯æŒå¤šä¸ªï¼Œæ¯è¡Œä¸€ä¸ªï¼Œé¡ºåºå¿…é¡»å’Œé‚®ç®±ä¸€è‡´ï¼‰ |

ç°åœ¨æŒ‰ç…§ [é“¾æ¥](https://logi.im/go/aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vemgtY24vYXp1cmUvYWN0aXZlLWRpcmVjdG9yeS9mdW5kYW1lbnRhbHMvY29uY2VwdC1mdW5kYW1lbnRhbHMtc2VjdXJpdHktZGVmYXVsdHMjZGlzYWJsaW5nLXNlY3VyaXR5LWRlZmF1bHRz) è¯´æ˜ï¼Œå…³é—­ E5 ç®¡ç†å‘˜è´¦å·çš„ `ä¸¤æ­¥éªŒè¯ï¼ˆå¤šå› ç´ è®¤è¯ã€å®‰å…¨é»˜è®¤å€¼ï¼‰`ã€‚

ä¸€å®šè¦æŒ‰ç…§é“¾æ¥é‡Œçš„ 1-5 æ­¥å…³é—­ä¸¤æ­¥éªŒè¯ï¼ˆå¤šå› ç´ è®¤è¯ã€å®‰å…¨é»˜è®¤å€¼ï¼‰ï¼Œå¦åˆ™æ— æ³•æ³¨å†ŒæˆåŠŸï¼Œè¿›è€Œæ— æ³•è°ƒç”¨ APIã€‚

ç°åœ¨è½¬åˆ° `Action` é¢æ¿ï¼Œåœ¨ `All workflows` ä¸‹æ‰¾åˆ° `Register APP`ï¼Œæ‰‹åŠ¨è§¦å‘å®ƒå®Œæˆæ³¨å†Œæµç¨‹ï¼Œ2 åˆ†é’Ÿå·¦å³ã€‚å¦‚æœç¡®è®¤ä¸€åˆ‡æ“ä½œæ­£ç¡®ä»ç„¶ `Register` å¤±è´¥ï¼Œå¯ç­‰å¾… 10-30min åå†æ“ä½œï¼Œå› ä¸ºå…³é—­å®‰å…¨é»˜è®¤å€¼åï¼Œå¾®è½¯ç³»ç»Ÿè¦è¿‡ä¸€æ®µæ—¶é—´æ‰ä¼šåˆ·æ–°ã€‚

å¦‚æœ `Action` é¢æ¿æ‰¾ä¸åˆ° `Register APP`ï¼Œåˆ™ä¿®æ”¹ `.github/workflows` ç›®å½•ä¸‹çš„ä¸¤ä¸ªæ–‡ä»¶ï¼Œéšä¾¿æ·»åŠ ä¸€è¡Œæ³¨é‡Šä¿å­˜ï¼Œè¯¦ç»†è¿‡ç¨‹è§ä¸Šæ–¹è§†é¢‘ã€‚å¦‚æœ `Action` é¢æ¿ä¸æ˜¾ç¤ºï¼Œåˆ™åˆ°ä»“åº“çš„ `Settings -> Actions -> Actions permissions` å‹¾é€‰ `Allow all actions` åä¿å­˜ï¼Œå…·ä½“å‚è€ƒ [è¯¥é“¾æ¥](https://logi.im/go/aHR0cHM6Ly9kb2NzLmdpdGh1Yi5jb20vZW4vcmVwb3NpdG9yaWVzL21hbmFnaW5nLXlvdXItcmVwb3NpdG9yeXMtc2V0dGluZ3MtYW5kLWZlYXR1cmVzL2VuYWJsaW5nLWZlYXR1cmVzLWZvci15b3VyLXJlcG9zaXRvcnkvbWFuYWdpbmctZ2l0aHViLWFjdGlvbnMtc2V0dGluZ3MtZm9yLWEtcmVwb3NpdG9yeSNtYW5hZ2luZy1naXRodWItYWN0aW9ucy1wZXJtaXNzaW9ucy1mb3IteW91ci1yZXBvc2l0b3J5)ã€‚éƒ¨åˆ†ç”¨æˆ·è´¦å·ç”±äºä¹‹å‰è·‘å…¶å®ƒè¿è§„é¡¹ç›®è¢«å°ç¦ Action åŠŸèƒ½çš„ï¼Œè‡ªè¡Œæ³¨å†Œæ–°è´¦å·ã€‚

åŠ¡å¿…ç¡®ä¿è¿è¡Œæ—¥å¿—å¦‚ä¸‹å›¾ä¸€æ ·åŒ…å«æˆåŠŸå­—æ ·ï¼Œå¦åˆ™å¿…é¡»æŒ‰ç…§æç¤ºè§£å†³é—®é¢˜åå†é‡æ–°å¯åŠ¨æ³¨å†ŒåŠ¨ä½œï¼Œç›´åˆ°æ³¨å†ŒæˆåŠŸã€‚

## åº”ç”¨æ³¨å†ŒæˆåŠŸ

![](https://image.baidu.com/search/down?tn=download&url=https://p3-tt.byteimg.com/origin/pgc-image/452212730e3e4661b318c968c8db2f10.png)

## API è°ƒç”¨æˆåŠŸ

![](https://image.baidu.com/search/down?tn=download&url=https://p3-tt.byteimg.com/origin/pgc-image/75f67d9a19214550aeb2e0f0e9c255af.png)

å†æ‰¾åˆ° `Invoke API` æ‰‹åŠ¨è§¦å‘å®ƒçœ‹èƒ½å¦æˆåŠŸè°ƒç”¨ APIã€‚å¦‚æ— é”™è¯¯ï¼Œä»»åŠ¡ä¼šå®šæ—¶æ‰§è¡Œï¼ŒåŸºæœ¬å¯ä¿è¯ç»­è®¢æˆåŠŸã€‚

#  OneDrive æ­å»ºä¸ªäººç½‘ç›˜

è¿™æ˜¯ä¸€ä¸ªç®€çŸ­çš„æ„å»ºä½ è‡ªå·±çš„ onedrive-vercel-index çš„æŒ‡å¯¼ã€‚

1.  Fork [æ­¤é¡¹ç›®](https://github.com/spencerwooo/onedrive-vercel-index)ã€‚
2.  å°† `site.config.js` é‡Œçš„ `userPrincipleName` æ”¹ä¸ºä½ çš„å¾®è½¯è´¦æˆ·é‚®ç®±ã€‚
3.  å°† `site.config.js` é‡Œçš„ `baseDirectory` ä¿®æ”¹ä¸ºä½ è¦åˆ†äº«çš„æ–‡ä»¶å¤¹è·¯å¾„ã€‚
4.  æ ¹æ®ä½ çš„ OneDrive ç‰ˆæœ¬ç¤ºæƒ…å†µä¿®æ”¹ `api.config.js`ã€‚
5.  å°†ä½ çš„é¡¹ç›®å¯¼å…¥åˆ° Vercel å¹¶ [æ·»åŠ  Upstash æ’ä»¶](https://vercel.com/integrations/upstash) ä»¥æ›´æ–¹ä¾¿åœ°è®¾ç½® `REDIS_URL` ç¯å¢ƒå˜é‡ã€‚
6.  éƒ¨ç½²ï¼Œå¹¶äº«å—ï¼ ğŸ‰

éƒ¨ç½²å®Œæˆåçš„é¡¹ç›®ä¼šå¼•å¯¼ä½ è¿›è¡Œ OAuth æ­¥éª¤ï¼Œå¹¶è‡ªåŠ¨å°†æ‰€éœ€çš„å‡­è¯å­˜å‚¨åˆ° Redis æ•°æ®åº“é‡Œã€‚è¿™å°±æ˜¯æˆ‘ä»¬è¦åšçš„å…¨éƒ¨äº‹æƒ…ï¼

### ç«‹å³ä¸Šæ‰‹

ä½¿ç”¨ onedrive-vercel-index æ¥å…±äº«ã€é¢„è§ˆä½ çš„ OneDrive é‡Œçš„æ–‡ä»¶ã€è§†é¢‘ã€éŸ³é¢‘ã€æ–‡æ¡£ï¼Œå¹¶æä¾›ä¸‹è½½ã€‚

![](https://ovi.swo.moe/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fod-vercel-idx.e3a31cab.png&w=3840&q=75)

onedrive-vercel-index æœ¬è´¨ä¸Šå°±æ˜¯ç”± Next.js æ„å»ºçš„æ¨¡æ¿ï¼Œä½ å¯ä»¥å°†å…¶å…è´¹éƒ¨ç½²åœ¨ Vercelã€Netlify æˆ–è€…å…¶ä»–æ‰˜ç®¡å¹³å°ä¸Šã€‚ä¸‹é¢æˆ‘ä»¬å°† **å®Œå…¨ä»å¤´å¼€å§‹** åˆ›å»ºä½ è‡ªå·±çš„ onedrive-vercel-indexã€‚

## Fork æ­¤é¡¹ç›®

å°†æ­¤é¡¹ç›® Fork åˆ°ä½ è‡ªå·±çš„ GitHub è´¦æˆ·ä¸­ï¼Œå› ä¸ºä½ ä¼šéœ€è¦ç»´æŠ¤ä¸€ä¸ªåŒ…å«ä½ è‡ªå·±é…ç½®çš„é¡¹ç›®ã€‚

![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

## ä¿®æ”¹è®¾ç½®

æœ‰äº›è®¾ç½®æ˜¯éœ€è¦ä¿®æ”¹çš„ã€‚é¡¹ç›®åŒ…æ‹¬ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯ `config/site.config.js` ä¸ `config/api.config.js`ã€‚å‰è€…æ˜¯ç”¨æ¥å®šåˆ¶ä½ çš„ç½‘é¡µçš„ï¼Œåè€…é‚£ä¸ªæ˜¯ç”¨æ¥å®šä¹‰ API å‚æ•°çš„ã€‚

### å®¢åˆ¶åŒ–ç½‘ç«™

è¯·æ ¹æ®è‡ªèº«æƒ…å†µä¿®æ”¹ [`config/site.config.js`](https://github.com/spencerwooo/onedrive-vercel-index/blob/main/config/site.config.js)ï¼š

*   `userPrincipalName` - æ˜¯ç”¨æ¥åœ¨ OAuth æ­¥éª¤æ—¶è®¤è¯ä½ çš„ä¸ªäººä¿¡æ¯çš„ã€‚é€šå¸¸æ˜¯ä½ çš„ **å¾®è½¯è´¦æˆ·é‚®ç®±**ã€‚
*   `baseDirectory` - æ˜¯ä½ è¦åˆ†äº«çš„ OneDrive ç›®å½•ã€‚ä½ å¿…é¡»ä¿è¯æ­¤ç›®å½•æœ‰æ•ˆä¸”ä¸æ­¤å‚æ•°ä¸€è‡´ã€‚ï¼ˆä½ å¯ä»¥ç›´æ¥åœ¨ OneDrive å†…åˆ›å»ºä¸€ä¸ªå«åš `Public` æ–‡ä»¶å¤¹ï¼Œå¹¶å°†æ­¤é¡¹è®¾ç½®ä¸º `/Public`ã€‚ï¼‰

![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

æœ‰äº›è®¾ç½®æ˜¯ä¸ºä½ è‡ªå®šä¹‰è‡ªå·±çš„ç½‘é¡µè€Œå‡†å¤‡çš„ï¼Œè¯¦æƒ…è¯·å‚è€ƒ [è‡ªå®šä¹‰é…ç½®](https://ovi.swo.moe/zh/docs/custom-configs)ã€‚

### ä¿®æ”¹ API å‚æ•°ï¼ˆå¯é€‰é¡¹ï¼‰

å¦‚æœâ€¦â€¦

*   ä½ æ˜¯ **OneDrive å›½é™…ç‰ˆç”¨æˆ·**ï¼ˆä¸æ˜¯ OneDrive ä¼ä¸šç‰ˆæˆ–æ•™è‚²ç‰ˆï¼Œä¸æ˜¯ SharePoint ç”¨æˆ·ï¼Œä¸æ˜¯ E5 è®¢é˜…ç”¨æˆ·ï¼‰ï¼Œè¯·ç›´æ¥å¿½ç•¥æ­¤æ­¥éª¤ï¼Œä¸è¦ç¢° `config/api.config.js`ã€‚

å¦‚æœä¸æ˜¯ï¼Œ**æˆ–è€…ä½ è‡ªå·±è§‰å¾—çœŸçš„æœ‰å¿…è¦ä¿®æ”¹**ï¼š

* OneDrive ä¸–çºªäº’è”ä½¿ç”¨äº†ä¸åŒçš„ API å‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä¿®æ”¹ `authApi` å’Œ `driveApi`

  ![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

  å°†å®ƒä»¬ä¿®æ”¹ä¸ºï¼š

  ```
  authApi: "https://login.partner.microsoftonline.cn/common/oauth2/v2.0/token",
  driveApi: "https://microsoftgraph.chinacloudapi.cn/v1.0/me/drive",
  ```

* OneDrive ä¼ä¸šç‰ˆã€æ•™è‚²ç‰ˆä»¥åŠ E5 è®¢é˜…çš„ç”¨æˆ·éœ€è¦æ³¨æ„ï¼šå…ˆå°è¯•åœ¨ä¸ä¿®æ”¹ `config/api.config.js` çš„æƒ…å†µä¸‹è¿›è¡Œ OAuth **æ— è®ºä½ æ˜¯å¦æœ‰ç®¡ç†æƒé™**ã€‚å¦‚æœä½ è¢«å‘ŠçŸ¥éœ€è¦ç®¡ç†æƒé™ï¼Œä½ å°±è¦ä½¿ç”¨ä½ è‡ªå·±çš„ `clientId` ä¸ `clientSecret` äº†ã€‚

### ä½¿ç”¨ä½ è‡ªå·±çš„ client id ä¸ secret

å¦‚æœä½ çš„è´¦æˆ·æ²¡æœ‰ç®¡ç†æƒé™ï¼Œé‚£ä¹ˆä½ å°±æ— æ³•ä½¿ç”¨é¡¹ç›®æä¾›çš„ `clientId` ä¸ `clientSecret`ã€‚è¿™ä¸ªæƒ…å†µä¸‹ï¼Œä½ å°±è¦ç”Ÿæˆä½ è‡ªå·±çš„ client id ä¸ secret äº†ã€‚

### æ³¨å†Œä¸€ä¸ªåº”ç”¨ç¨‹åº

æ‰“å¼€ä»¥ä¸‹é“¾æ¥ï¼š

*   [Microsoft Azure App registrations](https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade)ï¼ˆ OneDrive å›½é™…ç‰ˆã€ä¼ä¸šç‰ˆä¸æ•™è‚²ç‰ˆï¼ŒE5 è®¢é˜…ä¸“ç”¨ï¼‰
*   [Microsoft Azure.cn App registrations](https://portal.azure.cn/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade)ï¼ˆOneDrive ä¸–çºªäº’è”ä¸“ç”¨ï¼‰

åˆ›å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºï¼š

1. ç™»å…¥ä½ çš„å¾®è½¯è´¦æˆ·ï¼Œç‚¹å‡» _New registration_ã€‚

2. è¾“å…¥ä¸€ä¸ªåå­—ï¼Œä¾‹å¦‚ my-onedrive-vercel-indexã€‚

3. å°† _Supported account types_ è®¾ç½®ä¸ºï¼š

   ```
   Accounts in any organizational directory (Any Azure AD directory - Multitenant) and personal Microsoft accounts (e.g. Skype, Xbox)
   
   ```

   OneDrive ä¸–çºªäº’è”ç”¨æˆ·è®¾ç½®ä¸º - ä»»ä½•ç»„ç»‡ç›®å½•ï¼ˆä»»ä½• Azure AD ç›®å½• - å¤šç§Ÿæˆ·ï¼‰ä¸­çš„å¸æˆ·ã€‚

4. å°† _Redirect URI (optional)_ è®¾ç½®ä¸º `Web`ï¼ˆåœ¨ä¸‹æ‹‰èœå•é‡Œï¼‰ä»¥åŠ `http://localhost`ã€‚

5. ç‚¹å‡»æ³¨å†Œã€‚

![](data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='2048' height='1420'/>)
![](https://ovi.swo.moe/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fregister-an-application.91b5cc67.png&w=3840&q=75)

### è·å–ä½ çš„ client id ä¸ secret

ä½ çš„åº”ç”¨ (client) ID å°±æ˜¯ `api.config.js` é‡Œçš„ `clientId` ï¼Œå®ƒåº”è¯¥å‡ºç°åœ¨ _Overview_ > _Essentials_ã€‚

![](data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='2100' height='654'/>)
![](https://ovi.swo.moe/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fget-client-id.7f11595f.png&w=3840&q=75)

ä½ çš„ client secret éœ€è¦æ‰‹åŠ¨è·å–

1.  ç‚¹å‡» _Certificates & secrets_ã€‚
2.  ç‚¹å‡» _New client secret_ã€‚
3.  åˆ›å»ºä¸€ä¸ªæ–° secret ï¼Œæè¿°ä¸º `client_secret`ã€‚
4.  å°† _Expires_ è®¾ç½®ä¸º `Custom`ã€‚
5.  å°† _Start_ ä¸ _End_ è®¾ç½®ä¸ºèƒ½è®¾ç½®çš„æœ€é•¿æ—¶é—´ã€‚

![](data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='2398' height='1488'/>)
![](https://ovi.swo.moe/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fcreate-client-secret.3c3eb9c9.png&w=3840&q=75)

æœ€åï¼Œç‚¹å‡» _Add_ ï¼Œç„¶åå¤åˆ¶ client\_secret çš„å€¼å¹¶å¦¥å–„ä¿ç®¡ã€‚ï¼ˆåªæœ‰ä¸€æ¬¡å¤åˆ¶æœºä¼šï¼‰

![](data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='1846' height='416'/>)
![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

### ä¿®æ”¹ API æƒé™

Microsoft Graph API å¯ä»¥è®¾ç½® API èŒƒå›´ï¼Œæˆ‘ä»¬åªéœ€è¦ä»¥ä¸‹ä¸‰ä¸ªï¼ˆ `api.config.js` é‡Œè¦æ±‚çš„ï¼‰ï¼š

```
user.read files.read.all offline_access

```

ç‚¹å‡» _API permissions_ï¼Œå†ç‚¹å‡» _Microsoft Graph_ï¼Œå†ç‚¹å‡» _Delegated permissions_ï¼Œç„¶åæœç´¢ï¼š

*   User.Readï¼ˆè¿™åº”è¯¥ä¸€å¼€å§‹å°±å‹¾ä¸Šäº†ï¼‰
*   Files.Read.All
*   offline\_access

é€‰æ‹©å…¨éƒ¨ä¸‰ä¸ªå¹¶ç‚¹å‡» _Add permissions_ã€‚

![](data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='1700' height='1862'/>)
![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

ç°åœ¨ï¼Œä½ å°±å‡†å¤‡å¥½ä½ è‡ªå·±çš„ `clientId` ä¸ `clientSecret` äº†ã€‚

#### ä¿®æ”¹ `api.config.js`

ä½ å¯ä»¥ç›´æ¥å°† `clientId` ä¿®æ”¹ä¸ºä½ è‡ªå·±çš„ `clientId`ã€‚

ä½†æ˜¯ï¼Œ**client secret éœ€è¦ä¿å¯†**ï¼Œä½ éœ€è¦åœ¨ä¸‹é¢è¿›è¡Œ **AES åŠ å¯†**ï¼š

Obfuscate your client secret ğŸ‘‡

Your client secret:

Your obfuscated client secret:

å¡«å†™ client secret åï¼Œä½ åº”è¯¥å¾—åˆ°ä¸€ä¸ªé•¿å¾—åƒè¿™æ ·çš„å­—ç¬¦ä¸²ï¼š

```
U2FsdGVkX1830zo3/pFDqaBCVBb37iLw3WnBDWGF9GIB2f4apzv0roemp8Y+iIxI3Ih5ecyukqELQEGzZlYiWg==
```

å°†å®ƒæ›¿æ¢åˆ° `obfuscatedClientSecret` é‡Œã€‚

å¦‚æœä½ ä¿®æ”¹äº† `redirectUri` ä¸ºå…¶ä»–å€¼ï¼Œä½ ä¹Ÿè¦åœ¨ `api.config.js` é‡Œè®¾ç½®å¥½ã€‚

> å¯èƒ½å¾ˆå¤šåƒæˆ‘ä¸€æ ·çš„å°ç™½æƒ³ä½¿ç”¨è‡ªå·±çš„`secret`ï¼Œä½†åˆä¸çŸ¥é“å¦‚ä½•åŠ å¯†ã€‚æˆ‘æŠ˜è…¾äº†å¾ˆä¹…æ‰æ‘¸ç´¢å‡ºæ¥ï¼Œä½¿ç”¨è¿™ä¸ªåœ¨çº¿åŠ å¯†å·¥å…· https://www.dute.org/aes ï¼ŒåŸå§‹æ–‡æœ¬å¡«å…¥è‡ªå·±çš„`secret`ï¼Œç§˜é’¥å¡«å…¥`onedrive-vercel-index`ï¼Œ`åŠ /è§£å¯†æ¨¡å¼`é€‰æ‹©`CBC (Cipher Block Chaining, Default)`ï¼Œç‚¹å‡»`AES åŠ å¯†`å°±å¯ä»¥äº†ã€‚

## å¯¼å…¥åˆ° Vercel å¹¶éƒ¨ç½²

åœ¨ Vercel å¯¼å…¥ **ä½ è‡ªå·±çš„** onedrive-vercel-index GitHub é¡¹ç›®ï¼Œå¹¶è¿›è¡Œä»¥ä¸‹è®¾ç½®ï¼š

*   ä¿®æ”¹ Build command ä¸º `pnpm build`.
*   ä¿®æ”¹ Install command ä¸º `pnpm install`.

é»˜è®¤çš„ä¹Ÿè®¸èƒ½æ­£å¸¸å·¥ä½œï¼Œä½†æœ€å¥½è¿˜æ˜¯è‡ªå®šä¹‰è¿™ä¸€é¡¹ç›®ã€‚

![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

ç„¶åç‚¹å‡»éƒ¨ç½²ï¼ŒVercel å°†ä¼šä¸‹è½½ä½ çš„é¡¹ç›®å¹¶è¿›è¡Œéƒ¨ç½²ã€‚è¿™æ¬¡éƒ¨ç½²æœ‰å¯èƒ½ä¼šå¤±è´¥ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰è®¾å®š `REDIS_URL` ç¯å¢ƒå˜é‡ã€‚è¿™å°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦åšçš„ã€‚

### è¿æ¥åˆ° Redis

åˆ›å»ºä¸€ä¸ª Redis æ•°æ®åº“ï¼Œå¹¶ä¸”å°†æ•°æ®åº“çš„è®¿é—®é“¾æ¥å¡«å†™åˆ° Vercel çš„ `REDIS_URL` ç¯å¢ƒå˜é‡é‡Œã€‚Redis æ•°æ®åº“æ˜¯ç”¨äºå­˜å‚¨åœ¨ OAuth æ—¶è·å–çš„ `access_tokens` ä¸ `refresh_tokens` çš„ã€‚

*   æˆ‘ä»¬æ¨èä½¿ç”¨ **Upstash** ï¼Œå®ƒå®Œå…¨å…è´¹ï¼Œå¹¶ä¸”ä¸ Vercel æ·±åº¦åˆä½œï¼Œè¯¦æƒ…è¯·å‚è€ƒ [Vercel Integration](https://docs.upstash.com/redis/howto/vercelintegration)ã€‚ï¼ˆè¯·å¿½ç•¥æœ€åä¸€æ­¥æ—¶è®©ä½  _Create Your Redis Client_ ï¼Œonedrive-vercel-index å·²ç»ä¸ºä½ å¤„ç†å¥½äº†ï¼‰ã€‚
*   ä½ å¯ä»¥ä½¿ç”¨ä½ è‡ªå·±çš„ Redis æ•°æ®åº“ï¼Œåªè¦æœ‰ Vercel èƒ½ç”¨çš„è®¿é—®é“¾æ¥å°±è¡Œã€‚

æ— è®ºä½ ç”¨ä»€ä¹ˆæ–¹å¼ï¼Œä½ åº”è¯¥åœ¨ Vercel çš„ `REDIS_URL` ç¯å¢ƒå˜é‡é‡Œå¡«å¥½ä¸€ä¸ªç±»ä¼¼è¿™æ ·çš„ Redis URLï¼š

```
redis://:xxx...@some-thing-like-35533.upstash.io:35533

```

å¦‚æœä½ ä¸º Redis æ•°æ®åº“å¯ç”¨äº† [ä¼ è¾“åŠ å¯†](https://docs.upstash.com/redis/howto/connectwithtls)ï¼š

```
rediss://:xxx...@some-thing-like-35533.upstash.io:35533

```

![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

### é‡æ–°éƒ¨ç½²

æœ€åï¼Œé‡æ–°è¿›è¡Œä¸€æ¬¡éƒ¨ç½²ã€‚å¹¶åœ¨éƒ¨ç½²å®Œæˆåè®¿é—® Vercel æä¾›çš„é“¾æ¥ï¼Œ`onedrive-vercel-index` å°†ä¼šå¼•å¯¼ä½ è¿›è¡Œ OAuth è®¤è¯ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨ Vercel è‡ªå®šä¹‰è®¿é—®é“¾æ¥ï¼Œè¯¦æƒ…è¯·å‚è€ƒ [è‡ªå®šä¹‰åŸŸå](https://ovi.swo.moe/zh/docs/advanced)ã€‚

![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

## è¿›è¡Œè®¤è¯

è®¿é—®ä½ çš„ `onedrive-vercel-index` ï¼Œå¦‚æœä½ ä»æœªè¿›è¡Œè®¤è¯ï¼ŒOAuth è®¤è¯å°†ä¼šè‡ªåŠ¨å¼€å§‹ã€‚

### ç¬¬ä¸€æ­¥ å‡†å¤‡å·¥ä½œ

![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

æ£€æŸ¥æ­¤é¡µé¢ä¸Šçš„å‚æ•°æ˜¯å¦æ­£ç¡®ï¼Œå°¤å…¶æ˜¯ `client_id` ä¸ `client_secret` ï¼ˆåŠ å¯†çš„ï¼‰ï¼Œä»–ä»¬åº”è¯¥ä¸ä½ çš„é¡¹ç›®é‡Œçš„ä¸€è‡´ã€‚ä½ è¿˜è¦æ£€æŸ¥ä¸€ä¸‹ API æƒé™ï¼Œåº”è¯¥åªéœ€è¦è¿™ä¸‰ä¸ªï¼š

*   `user.read`: åœ¨è¿›è¡Œ OAuth æ—¶è®¤è¯ä½ çš„èº«ä»½ï¼Œé˜²æ­¢æŸäº›å‚»é€¼é€šè¿‡é‡æ–°è®¤è¯é›·æ™®ä½ çš„é¡¹ç›®ã€‚
*   `files.read.all`: ç”¨äºè®¿é—®ä½ çš„ OneDrive çš„æ–‡ä»¶
*   `offline_access`: å°±æ˜¯â€¦â€¦ç”¨æ¥ç¦»çº¿è®¿é—® ğŸ™ƒ

å¦‚æœä¸€åˆ‡éƒ½å‡†å¤‡å¥½äº†ï¼Œå°±æ¥åˆ°ç¬¬äºŒæ­¥ã€‚å¦‚æœæœ‰äº›ä»€ä¹ˆå·®é”™ï¼Œæ£€æŸ¥ä½ çš„ `config/api.config.js` ç„¶åé‡æ–°éƒ¨ç½²ã€‚

### ç¬¬äºŒæ­¥ è·å–è®¤è¯ç 

![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

æˆ‘ä»¬å·²ç»åŸºäº `config/api.config.js` ç»™ä½ å‡†å¤‡å¥½è®¤è¯é“¾æ¥äº†ã€‚ç‚¹å‡»é“¾æ¥ï¼Œä½ å°†ä¼šè¿›å…¥ä¸€ä¸ªæ–°æ ‡ç­¾é¡µå¹¶è¿›è¡Œç™»å½•ã€‚è¯·ç¡®ä¿ä½ ç™»é™†çš„è´¦æˆ·ä¸ä½ åœ¨ `config/site.config.js` çš„ `userPrincipalName` é‡Œè®¾ç½®çš„ä¸€è‡´ã€‚

![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

å®Œæˆç™»å½•åï¼Œä½ å°†ä¼šè·³è½¬åˆ° `http://localhost` ï¼Œå°½ç®¡å®ƒæ˜¾ç¤ºæ— æ³•è®¿é—®ï¼Œä½ åªéœ€è¦å¤åˆ¶åœ°å€æ ä¸­çš„åœ°å€ç„¶åç²˜è´´åˆ°ç¬¬äºŒæ­¥çš„è¾“å…¥æ¡†é‡Œã€‚onedrive-vercel-index ä¼šè‡ªåŠ¨è¯†åˆ«ç”¨äºè·å– `access_token` ä¸ `refresh_token` çš„è®¤è¯ç ï¼Œç„¶åç‚¹å‡» _Get tokens_ å°±è¡Œã€‚

### ç¬¬ä¸‰æ­¥ è·å–å‡­è¯

![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

ä½ åªéœ€è¦ç­‰å¾…å‡ ç§’é’Ÿï¼Œé¡µé¢ä¸Šå°±ä¼šæ˜¾ç¤ºæˆåŠŸæç¤ºä»¥åŠå‡ è¡Œå‡­è¯ï¼Œè¯·ç‚¹å‡» _Store tokens_ ï¼Œä½ çš„å‡­è¯å°±ä¼šä¿å­˜åˆ° Redis æ•°æ®åº“é‡Œã€‚

*ğŸ“¢è¿™ä¸ªè¿‡ç¨‹ä¸­æˆ‘ä»¬ä¸€ç›´åœ¨æ£€æŸ¥ **ä½ çš„èº«ä»½** ï¼Œæ‰€ä»¥å¦‚æœå‡ºç°äº† "Don't pretend to be the site owner" æç¤ºï¼Œè¯·æ£€æŸ¥ `config/site.config.js` é‡Œçš„ `userPrincipalName`æ˜¯å¦å¡«å†™æ­£ç¡®ã€‚*

æœ€åï¼Œä½ å°†ä¼šè·³è½¬åˆ°ä½ å…¨æ–°çš„ onedrive-vercel-index ï¼Œå®Œæˆï¼

> âš ï¸å¦‚æœä½ è®¤è¯ç»“æŸåè¢«é‡æ–°è·³è½¬åˆ°æ­¥éª¤ä¸€ï¼Œè€Œä½ ç¡®è®¤ä¸€åˆ‡éƒ½æ²¡æœ‰é—®é¢˜æ—¶ï¼Œ**è¯·ç­‰å¾…å‡ ç§’å¹¶æ‰‹åŠ¨å›åˆ°ä¸»é¡µå†åˆ·æ–°**ï¼ŒRedis æ•°æ®åº“å­˜å–å‡­è¯éœ€è¦ä¸€ç‚¹å„¿æ—¶é—´ã€‚

## è‡ªå®šä¹‰åŸŸå

è¯¦æƒ…è¯·å‚è€ƒ [Custom Domains - Vercel](https://vercel.com/docs/concepts/projects/custom-domains)ã€‚

## ä½¿ç”¨å¯†ç ä¿æŠ¤ä½ çš„æ–‡ä»¶å¤¹

ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªéœ€è¦å¯†ç æ‰èƒ½è®¿é—®çš„æ–‡ä»¶å¤¹ã€‚

### æ­¥éª¤

*   ä½ éœ€è¦åœ¨ `config/site.json` çš„ `protectedRoutes` å¤„æ·»åŠ è¦ä¿æŠ¤çš„æ–‡ä»¶å¤¹ã€‚
*   åœ¨è¦ä¿æŠ¤çš„æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º `.password` çš„ **ç©ºç™½æ–‡ä»¶**ã€‚
*   ä½¿ç”¨ä»»æ„æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€è¿™ä¸ª `.password` æ–‡ä»¶ï¼Œå¹¶åœ¨é‡Œé¢å¡«å†™è¯¥æ–‡ä»¶å¤¹çš„è®¿é—®å¯†ç ã€‚
*   æœ€åï¼Œåœ¨ Vercel ä¸­é‡æ–°éƒ¨ç½²è¯¥é¡¹ç›®ã€‚

### è®¾ç½®å—å¯†ç ä¿æŠ¤çš„æ–‡ä»¶å¤¹

å—å¯†ç ä¿æŠ¤çš„æ–‡ä»¶å¤¹ä¸»è¦ç”± `config/site.json` ä¸­çš„ `protectedRoutes` å±æ€§æŒ‡å®šï¼Œä¸¾ä¸ªä¾‹å­ ğŸ‘‡

å‡è®¾ä½ æœ‰è¿™æ ·ä¸€ä¸ªæ–‡ä»¶ç»“æ„ï¼š

```
.
â”œâ”€â”€ ğŸ“• Books
â”‚   â””â”€â”€ ...
â”œâ”€â”€ ğŸŒ Private folder
â”‚   â”œâ”€â”€ this-is-public
â”‚   â””â”€â”€ u-need-a-password   <-- ä½ æƒ³è¦ç”¨å¯†ç ä¿æŠ¤è¿™ä¸ªæ–‡ä»¶å¤¹
â”œâ”€â”€ ğŸ¡ Genshin PV
â”‚   â””â”€â”€ ...
â””â”€â”€ README.md

```

æˆ‘ä»¬æƒ³è¦å°† `/u-need-a-password` è®¾ä¸ºå—å¯†ç ä¿æŠ¤çš„æ–‡ä»¶å¤¹ï¼Œå°±æŠŠå®ƒçš„ç»å¯¹è·¯å¾„æŒ‰ä¸‹åˆ—æ ¼å¼å¡«å†™åˆ° `protectedRoutes` é‡Œï¼š

```
"protectedRoutes": [
  "/ğŸŒ Private folder/u-need-a-password",
],
```

å¦‚æœä½ æƒ³è®¾ç½®å¦ä¸€ä¸ªå—å¯†ç ä¿æŠ¤çš„æ–‡ä»¶å¤¹ï¼Œé‚£å°±åœ¨ä¸‹ä¸€è¡ŒæŒ‰ä¸‹åˆ—æ ¼å¼æ·»åŠ å®ƒçš„ç»å¯¹è·¯å¾„ï¼š

```
"protectedRoutes": [
  "/ğŸŒ Private folder/u-need-a-password",
   "/another/route/for/me/to/protect",
],
```

å¦‚æœä½ æ²¡æœ‰ä»»ä½•å—å¯†ç ä¿æŠ¤çš„æ–‡ä»¶å¤¹ï¼Œé‚£ä¹ˆå°±æ·»åŠ ä¸€ä¸ª `[]` ä»¥å…³é—­æ­¤åŠŸèƒ½ï¼š

```
"protectedRoutes": [],
```

åœ¨ä¸Šè¿°æ·»åŠ çš„å—å¯†ç ä¿æŠ¤çš„è·¯å¾„çš„æ ¹ç›®å½•ä¸‹å†…åˆ›å»ºä¸€ä¸ª `.password` æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å†…çš„çº¯æ–‡æœ¬å†…å®¹å°±æ˜¯ä½ è®¿é—®è¯¥æ–‡ä»¶å¤¹æ—¶éœ€è¦çš„å¯†ç ã€‚

![](data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='800' height='410'/>)
![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

### æ³¨æ„äº‹é¡¹

æ˜¯çš„ï¼Œæ‰€æœ‰çœ‹èµ·æ¥å®‰å…¨çš„ä¿æŠ¤æªæ–½éƒ½å¹¶éæ— æ‡ˆå¯å‡»ã€‚

1. å—å¯†ç ä¿æŠ¤çš„æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ç›´é“¾å¯ä»¥é€šè¿‡ URL å‚æ•° `&odpt=<hashed_token>` åˆ†äº«ï¼Œå¦‚æœä½ çœŸçš„éœ€è¦çš„è¯ï¼š

   ```
   https://drive.swo.moe/api/raw/?path=/ğŸŒ%20Private%20folder/u-need-a-password/watch%20this.mp4&odpt=c8ebdc273d673d167c238dd25a997bdf9b4ecbf589452697c1a6cb416b2ed11d
   ```
   
   æˆ‘ä»¬å¹¶ä¸çŸ¥é“è¿™æ˜¯å¦ä¼šæš´éœ²ä½ çš„å¯†ç ï¼Œå—å¯†ç ä¿æŠ¤çš„æ–‡ä»¶ï¼Œä¸ªäººä¿¡æ¯ç­‰ç­‰ï¼Œæ‰€ä»¥è¯·è°¨æ…ä½¿ç”¨ã€‚
   
2. æˆ‘ä¸ªäººæ— æ³•ä¿è¯æ­¤ä¿æŠ¤åŠŸèƒ½å®Œå…¨å®‰å…¨ã€‚æ‰€ä»¥æˆ‘ä¸æ¨èä½¿ç”¨æ­¤æ–¹å¼å­˜æ”¾ä½ çš„ä¸ªäººéšç§ä¿¡æ¯ï¼Œè¿™åªæ˜¯ä¸ªåˆ†äº«çš„å¯é€‰é¡¹ã€‚

è¯¦æƒ…è¯·å‚è€ƒ [Password protected routes is now supported #66](https://github.com/spencerwooo/onedrive-vercel-index/discussions/66)ã€‚

æ›´æ–°ä½ çš„é¡¹ç›®
------

åŸºæœ¬ä¸Šä½ çš„é¡¹ç›®æ˜¯ä»æœ¬é¡¹ç›®ä¸­åˆ†æ”¯å‡ºå»çš„ï¼Œè¯¦æƒ…è¯·å‚è€ƒ [GitHub - Syncing a fork](https://docs.github.com/cn/pull-requests/collaborating-with-pull-requests/working-with-forks/syncing-a-fork)ã€‚

### åœ¨ç½‘é¡µæ›´æ–°æ‰“å¼€ä½ çš„é¡¹ç›®çš„ GitHub é¡µé¢

*   ç‚¹å‡» Fetch upstream ï¼Œå°†ä¼šå‡ºç°ä¸€ä¸ªä¸‹æ‹‰èœå•ã€‚
*   æ£€æŸ¥ä¸Šæ¸¸çš„æäº¤ç»†èŠ‚ï¼Œæ²¡é—®é¢˜çš„è¯å°±ç‚¹å‡» Fetch and mergeã€‚
*   å¦‚æœä¸Šæ¸¸çš„æ›´æ”¹ä¸ä½ çš„é¡¹ç›®å­˜åœ¨å†²çªï¼ŒGitHub ä¼šæ¨èä½ å¼€å¯ä¸€ä¸ª Pull request ä»¥è§£å†³å†²çªã€‚

### åœ¨å‘½ä»¤è¡Œæ›´æ–°

å°†ä½ çš„é¡¹ç›® Clone åˆ°æœ¬åœ°ï¼Œç„¶åï¼š

```bash
# æ‹‰å–ä¸Šæ¸¸çš„æ›´æ”¹
git fetch upstream

# æ£€æŸ¥ä½ çš„é¡¹ç›®çš„é»˜è®¤åˆ†æ”¯ï¼ˆé€šå¸¸æ˜¯ mainï¼‰
git checkout main

# åˆå¹¶ä¸Šæ¸¸çš„æ›´æ”¹
git merge upstream/main

# å¦‚æœå­˜åœ¨å†²çªï¼Œä¾¿åœ¨æœ¬åœ°è§£å†³
# æäº¤æ›´æ”¹å¹¶æ¨é€åˆ° GitHub
git commit -m "xxx"
git push
```

> æ–‡ç« å‡ºå¤„ï¼š[Office 365 E5 è´¦å·ç”³è¯·åŠæ°¸ä¹…ç»­æœŸæ•™ç¨‹ - LOGI](https://logi.im/script/permanently-keeping-an-office-e5-account.html)
> [onedrive-vercel-index](https://github.com/spencerwooo/onedrive-vercel-index): > [Getting started](https://ovi.swo.moe/docs/getting-started)