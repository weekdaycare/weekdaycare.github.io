---
title: OneDrive
tags:
  - 技术
categories:
  - 捣鼓
abbrlink: ondrive
date: 2022-05-19 00:44:37
---

> 你的仓库正在沦为肉鸡
>
> 由于 Github 漏洞，[攻击者可通过 Pull Request 运行挖矿程序](https://logi.im/go/aHR0cHM6Ly93d3cuZnJlZWJ1Zi5jb20vYXJ0aWNsZXMvcGFwZXIvMjY4ODI5Lmh0bWw=)，请删除原先 Fork 的代码，选择 [导入私有仓库](https://logi.im/go/aHR0cHM6Ly9kb2NzLmdpdGh1Yi5jb20vY24vZ2l0aHViL2ltcG9ydGluZy15b3VyLXByb2plY3RzLXRvLWdpdGh1Yi9pbXBvcnRpbmctYS1yZXBvc2l0b3J5LXdpdGgtZ2l0aHViLWltcG9ydGVy) 再运行 Action。

> 续订成功通知
>
> ![](https://image.baidu.com/search/down?tn=download&url=https://tva2.sinaimg.cn/large/006DZngIgy1gzj01pww7oj30gj0bldih.jpg)

`Office 365 E5` 是微软 **免费** 提供给开发者的 Office 临时管理号，任何人均可申请。该账号的最大权益便是可分配 25 个子账号，每个账号都拥有 `OneDrive 5T 存储` 和完整的 `Office 客户端` 使用权。

首次申请，可免费使用 90 天。到期后，根据微软机制，借助 Github Action 或 Tencent Servless 等平台的虚拟环境和定时任务功能，可实现 永久自动续期。

Office E5开发者账号申请步骤
========

打开 [申请链接](https://logi.im/go/aHR0cHM6Ly9kZXZlbG9wZXIubWljcm9zb2Z0LmNvbS9vZmZpY2UvcHJvZmlsZQ==)，`登录` 你的微软账户。如未注册过，点击图中的创建一个，在此不再赘述。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12096694967/0)

登录成功进入信息填写页面后，选择 `国家`，随意填写 `公司` 名称，勾选 `接受条款` 后，点击 `下一步`。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12099533891/0)

进入个性化体验页面后，`随意勾选` 几个必选项，点击 `加入`。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/14241020505/0.png)

进入下个页面后，点击 `设置 E5 订阅`。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12096775126/0)

在弹出的对话框中填写 `国家`、`用户名`、`域` 和 `密码` 后，点击 `继续`，注意在记事本 `保存你的密码`。

域即 `网址前缀`，填写后可能提示 `已被使用`，改用 `其他字母` 即可。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12096799759/0)

接着会要求绑定 `手机号`，由于网站使用了 `谷歌` 人机验证，因此需要科学上网。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/14241026089/0.png)

收到 `验证码` 后，填入对话框，点击 `设置`。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12096853407/0)

`等待一分钟` 左右，页面将显示订阅成功。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12096869353/0)

开始使用
========

打开 [Office 官网](https://logi.im/go/aHR0cHM6Ly93d3cub2ZmaWNlLmNvbS8%7CYXV0aD0y)，使用上图中的 `管理员账号` 和第五张图设置的 `密码` 登录。关闭向导后，点击页面中的 OneDrive 和 Word 图标等，即可使用 `网页端` 服务。如需使用 `客户端`，点击右上角的 `安装 Office - Office 365 应用`，使用下载的安装器，跟随步骤安装即可。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12096924747/0)

扩展空间
========

订阅号默认的 OneDrive 空间是 1T，可在管理页扩展为 5T。打开 [OneDrive 存储管理页](https://logi.im/go/aHR0cHM6Ly9hZG1pbi5vbmVkcml2ZS5jb20vP3Y9U3RvcmFnZVNldHRpbmdz)，`登录` 申请的管理号，将空间设置为 `5120` 后点击 `保存`。如页面 `无法加载`，则系统尚未完成初始化，`等待 24 小时` 后重新打开。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/14241029283/0.png)

子号分配
========

管理员可分配 25 个子号，每个账号都可使用 Office 365 并拥有 5T OneDrive 空间。点击页面中的 `管理` 按钮，进入管理员中心。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/12096959440/0)

点击左侧菜单栏的 `用户 - 活跃用户`，点击右侧的 `添加用户`，

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/14241032659/0.png)

在弹出的选项卡中，填写 `必要信息` 后，点击 `下一步`。

![](https://image.baidu.com/search/down?tn=download&url=https://inews.gtimg.com/newsapp_ls/0/14241032660/0.png)

在接下来的三个步骤中，全部 `保持默认选项`，直接点击 `下一步`，最后 `关闭` 选项卡。

自动续期
========

订阅的有效期是 `90` 天。到期前，如果微软检测到账号被用于开发，即 `API 被频繁且无规律调用`，将自动续期。因此，只需编写几行代码，定时高频调用其 API 即可。

`Github Action` 是 Github 提供给开发者使用的 `虚拟 Linux 环境`，可 `根据条件`，例如指定时间，`执行指定代码`。

## 添加任务

首先 [登录或注册](https://logi.im/go/aHR0cHM6Ly9naXRodWIuY29tLw==) 一个 Github 账号，在此不再赘述。~随后打开 [该仓库](https://logi.im/go/aHR0cHM6Ly9naXRodWIuY29tL3ZjaGVja3plbi9BdXRvQXBpU2VjcmV0)，点击右上角的 `Fork`~（会遭到攻击，想收藏可以 Star，禁止 Fork）。随后[导入私有仓库](https://logi.im/go/aHR0cHM6Ly9kb2NzLmdpdGh1Yi5jb20vY24vZ2l0aHViL2ltcG9ydGluZy15b3VyLXByb2plY3RzLXRvLWdpdGh1Yi9pbXBvcnRpbmctYS1yZXBvc2l0b3J5LXdpdGgtZ2l0aHViLWltcG9ydGVy)，在 `Your old repository’s clone URL` 里填写

```
*   https://github.com/vcheckzen/KeepAliveE5.git 
```

Privacy 务必选择 `Private`。

点击 `Begin Import`，稍等片刻，你的账号下便会复制一份该项目。

现在，创建一个具有 `workflow` 权限的个人访问密钥，用于同步上流代码。首先访问 [密钥创建页面](https://logi.im/go/aHR0cHM6Ly9naXRodWIuY29tL3NldHRpbmdzL3Rva2Vucy9uZXc=)，按照下图填写信息，随后将页面拉到最下方，点击绿色的 `Generate token` 按钮。

![](https://image.baidu.com/search/down?tn=download&url=https://img30.360buyimg.com/pop/jfs/t1/206051/13/12358/57553/6175299eEfe259c2b/a508c13c89a05d96.png)

接着，页面会跳转到创建成功页面，点击图中的 `复制` 图标，复制生成的 PAT 密钥备用。

![](https://image.baidu.com/search/down?tn=download&url=https://img30.360buyimg.com/pop/jfs/t1/214960/8/1710/21605/61752a54E0ea98893/1a7b13a656fe0f75.png)

现在只需为仓库添加下表中的三个密钥，具体过程请查看上方视频（视频中未添加 PAT，你要自己加上）

| Name   | Value                                                   |
| ------ | ------------------------------------------------------- |
| PAT    | Github 个人访问密钥，需要具有 workflow 权限             |
| USER   | E5 管理员邮箱（支持多个，每行一个，不要填写子号）       |
| PASSWD | E5 管理员密码（支持多个，每行一个，顺序必须和邮箱一致） |

现在按照 [链接](https://logi.im/go/aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vemgtY24vYXp1cmUvYWN0aXZlLWRpcmVjdG9yeS9mdW5kYW1lbnRhbHMvY29uY2VwdC1mdW5kYW1lbnRhbHMtc2VjdXJpdHktZGVmYXVsdHMjZGlzYWJsaW5nLXNlY3VyaXR5LWRlZmF1bHRz) 说明，关闭 E5 管理员账号的 `两步验证（多因素认证、安全默认值）`。

一定要按照链接里的 1-5 步关闭两步验证（多因素认证、安全默认值），否则无法注册成功，进而无法调用 API。

现在转到 `Action` 面板，在 `All workflows` 下找到 `Register APP`，手动触发它完成注册流程，2 分钟左右。如果确认一切操作正确仍然 `Register` 失败，可等待 10-30min 后再操作，因为关闭安全默认值后，微软系统要过一段时间才会刷新。

如果 `Action` 面板找不到 `Register APP`，则修改 `.github/workflows` 目录下的两个文件，随便添加一行注释保存，详细过程见上方视频。如果 `Action` 面板不显示，则到仓库的 `Settings -> Actions -> Actions permissions` 勾选 `Allow all actions` 后保存，具体参考 [该链接](https://logi.im/go/aHR0cHM6Ly9kb2NzLmdpdGh1Yi5jb20vZW4vcmVwb3NpdG9yaWVzL21hbmFnaW5nLXlvdXItcmVwb3NpdG9yeXMtc2V0dGluZ3MtYW5kLWZlYXR1cmVzL2VuYWJsaW5nLWZlYXR1cmVzLWZvci15b3VyLXJlcG9zaXRvcnkvbWFuYWdpbmctZ2l0aHViLWFjdGlvbnMtc2V0dGluZ3MtZm9yLWEtcmVwb3NpdG9yeSNtYW5hZ2luZy1naXRodWItYWN0aW9ucy1wZXJtaXNzaW9ucy1mb3IteW91ci1yZXBvc2l0b3J5)。部分用户账号由于之前跑其它违规项目被封禁 Action 功能的，自行注册新账号。

务必确保运行日志如下图一样包含成功字样，否则必须按照提示解决问题后再重新启动注册动作，直到注册成功。

## 应用注册成功

![](https://image.baidu.com/search/down?tn=download&url=https://p3-tt.byteimg.com/origin/pgc-image/452212730e3e4661b318c968c8db2f10.png)

## API 调用成功

![](https://image.baidu.com/search/down?tn=download&url=https://p3-tt.byteimg.com/origin/pgc-image/75f67d9a19214550aeb2e0f0e9c255af.png)

再找到 `Invoke API` 手动触发它看能否成功调用 API。如无错误，任务会定时执行，基本可保证续订成功。

#  OneDrive 搭建个人网盘

这是一个简短的构建你自己的 onedrive-vercel-index 的指导。

1.  Fork [此项目](https://github.com/spencerwooo/onedrive-vercel-index)。
2.  将 `site.config.js` 里的 `userPrincipleName` 改为你的微软账户邮箱。
3.  将 `site.config.js` 里的 `baseDirectory` 修改为你要分享的文件夹路径。
4.  根据你的 OneDrive 版本示情况修改 `api.config.js`。
5.  将你的项目导入到 Vercel 并 [添加 Upstash 插件](https://vercel.com/integrations/upstash) 以更方便地设置 `REDIS_URL` 环境变量。
6.  部署，并享受！ 🎉

部署完成后的项目会引导你进行 OAuth 步骤，并自动将所需的凭证存储到 Redis 数据库里。这就是我们要做的全部事情！

### 立即上手

使用 onedrive-vercel-index 来共享、预览你的 OneDrive 里的文件、视频、音频、文档，并提供下载。

![](https://ovi.swo.moe/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fod-vercel-idx.e3a31cab.png&w=3840&q=75)

onedrive-vercel-index 本质上就是由 Next.js 构建的模板，你可以将其免费部署在 Vercel、Netlify 或者其他托管平台上。下面我们将 **完全从头开始** 创建你自己的 onedrive-vercel-index。

## Fork 此项目

将此项目 Fork 到你自己的 GitHub 账户中，因为你会需要维护一个包含你自己配置的项目。

![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

## 修改设置

有些设置是需要修改的。项目包括两个配置文件，分别是 `config/site.config.js` 与 `config/api.config.js`。前者是用来定制你的网页的，后者那个是用来定义 API 参数的。

### 客制化网站

请根据自身情况修改 [`config/site.config.js`](https://github.com/spencerwooo/onedrive-vercel-index/blob/main/config/site.config.js)：

*   `userPrincipalName` - 是用来在 OAuth 步骤时认证你的个人信息的。通常是你的 **微软账户邮箱**。
*   `baseDirectory` - 是你要分享的 OneDrive 目录。你必须保证此目录有效且与此参数一致。（你可以直接在 OneDrive 内创建一个叫做 `Public` 文件夹，并将此项设置为 `/Public`。）

![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

有些设置是为你自定义自己的网页而准备的，详情请参考 [自定义配置](https://ovi.swo.moe/zh/docs/custom-configs)。

### 修改 API 参数（可选项）

如果……

*   你是 **OneDrive 国际版用户**（不是 OneDrive 企业版或教育版，不是 SharePoint 用户，不是 E5 订阅用户），请直接忽略此步骤，不要碰 `config/api.config.js`。

如果不是，**或者你自己觉得真的有必要修改**：

* OneDrive 世纪互联使用了不同的 API 参数，所以我们要修改 `authApi` 和 `driveApi`

  ![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

  将它们修改为：

  ```
  authApi: "https://login.partner.microsoftonline.cn/common/oauth2/v2.0/token",
  driveApi: "https://microsoftgraph.chinacloudapi.cn/v1.0/me/drive",
  ```

* OneDrive 企业版、教育版以及 E5 订阅的用户需要注意：先尝试在不修改 `config/api.config.js` 的情况下进行 OAuth **无论你是否有管理权限**。如果你被告知需要管理权限，你就要使用你自己的 `clientId` 与 `clientSecret` 了。

### 使用你自己的 client id 与 secret

如果你的账户没有管理权限，那么你就无法使用项目提供的 `clientId` 与 `clientSecret`。这个情况下，你就要生成你自己的 client id 与 secret 了。

### 注册一个应用程序

打开以下链接：

*   [Microsoft Azure App registrations](https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade)（ OneDrive 国际版、企业版与教育版，E5 订阅专用）
*   [Microsoft Azure.cn App registrations](https://portal.azure.cn/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade)（OneDrive 世纪互联专用）

创建一个应用程序：

1. 登入你的微软账户，点击 _New registration_。

2. 输入一个名字，例如 my-onedrive-vercel-index。

3. 将 _Supported account types_ 设置为：

   ```
   Accounts in any organizational directory (Any Azure AD directory - Multitenant) and personal Microsoft accounts (e.g. Skype, Xbox)
   
   ```

   OneDrive 世纪互联用户设置为 - 任何组织目录（任何 Azure AD 目录 - 多租户）中的帐户。

4. 将 _Redirect URI (optional)_ 设置为 `Web`（在下拉菜单里）以及 `http://localhost`。

5. 点击注册。

![](data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='2048' height='1420'/>)
![](https://ovi.swo.moe/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fregister-an-application.91b5cc67.png&w=3840&q=75)

### 获取你的 client id 与 secret

你的应用 (client) ID 就是 `api.config.js` 里的 `clientId` ，它应该出现在 _Overview_ > _Essentials_。

![](data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='2100' height='654'/>)
![](https://ovi.swo.moe/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fget-client-id.7f11595f.png&w=3840&q=75)

你的 client secret 需要手动获取

1.  点击 _Certificates & secrets_。
2.  点击 _New client secret_。
3.  创建一个新 secret ，描述为 `client_secret`。
4.  将 _Expires_ 设置为 `Custom`。
5.  将 _Start_ 与 _End_ 设置为能设置的最长时间。

![](data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='2398' height='1488'/>)
![](https://ovi.swo.moe/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fcreate-client-secret.3c3eb9c9.png&w=3840&q=75)

最后，点击 _Add_ ，然后复制 client\_secret 的值并妥善保管。（只有一次复制机会）

![](data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='1846' height='416'/>)
![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

### 修改 API 权限

Microsoft Graph API 可以设置 API 范围，我们只需要以下三个（ `api.config.js` 里要求的）：

```
user.read files.read.all offline_access

```

点击 _API permissions_，再点击 _Microsoft Graph_，再点击 _Delegated permissions_，然后搜索：

*   User.Read（这应该一开始就勾上了）
*   Files.Read.All
*   offline\_access

选择全部三个并点击 _Add permissions_。

![](data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='1700' height='1862'/>)
![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

现在，你就准备好你自己的 `clientId` 与 `clientSecret` 了。

#### 修改 `api.config.js`

你可以直接将 `clientId` 修改为你自己的 `clientId`。

但是，**client secret 需要保密**，你需要在下面进行 **AES 加密**：

Obfuscate your client secret 👇

Your client secret:

Your obfuscated client secret:

填写 client secret 后，你应该得到一个长得像这样的字符串：

```
U2FsdGVkX1830zo3/pFDqaBCVBb37iLw3WnBDWGF9GIB2f4apzv0roemp8Y+iIxI3Ih5ecyukqELQEGzZlYiWg==
```

将它替换到 `obfuscatedClientSecret` 里。

如果你修改了 `redirectUri` 为其他值，你也要在 `api.config.js` 里设置好。

> 可能很多像我一样的小白想使用自己的`secret`，但又不知道如何加密。我折腾了很久才摸索出来，使用这个在线加密工具 https://www.dute.org/aes ，原始文本填入自己的`secret`，秘钥填入`onedrive-vercel-index`，`加/解密模式`选择`CBC (Cipher Block Chaining, Default)`，点击`AES 加密`就可以了。

## 导入到 Vercel 并部署

在 Vercel 导入 **你自己的** onedrive-vercel-index GitHub 项目，并进行以下设置：

*   修改 Build command 为 `pnpm build`.
*   修改 Install command 为 `pnpm install`.

默认的也许能正常工作，但最好还是自定义这一项目。

![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

然后点击部署，Vercel 将会下载你的项目并进行部署。这次部署有可能会失败，这是因为我们还没有设定 `REDIS_URL` 环境变量。这就是我们接下来要做的。

### 连接到 Redis

创建一个 Redis 数据库，并且将数据库的访问链接填写到 Vercel 的 `REDIS_URL` 环境变量里。Redis 数据库是用于存储在 OAuth 时获取的 `access_tokens` 与 `refresh_tokens` 的。

*   我们推荐使用 **Upstash** ，它完全免费，并且与 Vercel 深度合作，详情请参考 [Vercel Integration](https://docs.upstash.com/redis/howto/vercelintegration)。（请忽略最后一步时让你 _Create Your Redis Client_ ，onedrive-vercel-index 已经为你处理好了）。
*   你可以使用你自己的 Redis 数据库，只要有 Vercel 能用的访问链接就行。

无论你用什么方式，你应该在 Vercel 的 `REDIS_URL` 环境变量里填好一个类似这样的 Redis URL：

```
redis://:xxx...@some-thing-like-35533.upstash.io:35533

```

如果你为 Redis 数据库启用了 [传输加密](https://docs.upstash.com/redis/howto/connectwithtls)：

```
rediss://:xxx...@some-thing-like-35533.upstash.io:35533

```

![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

### 重新部署

最后，重新进行一次部署。并在部署完成后访问 Vercel 提供的链接，`onedrive-vercel-index` 将会引导你进行 OAuth 认证。你也可以在 Vercel 自定义访问链接，详情请参考 [自定义域名](https://ovi.swo.moe/zh/docs/advanced)。

![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

## 进行认证

访问你的 `onedrive-vercel-index` ，如果你从未进行认证，OAuth 认证将会自动开始。

### 第一步 准备工作

![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

检查此页面上的参数是否正确，尤其是 `client_id` 与 `client_secret` （加密的），他们应该与你的项目里的一致。你还要检查一下 API 权限，应该只需要这三个：

*   `user.read`: 在进行 OAuth 时认证你的身份，防止某些傻逼通过重新认证雷普你的项目。
*   `files.read.all`: 用于访问你的 OneDrive 的文件
*   `offline_access`: 就是……用来离线访问 🙃

如果一切都准备好了，就来到第二步。如果有些什么差错，检查你的 `config/api.config.js` 然后重新部署。

### 第二步 获取认证码

![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

我们已经基于 `config/api.config.js` 给你准备好认证链接了。点击链接，你将会进入一个新标签页并进行登录。请确保你登陆的账户与你在 `config/site.config.js` 的 `userPrincipalName` 里设置的一致。

![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

完成登录后，你将会跳转到 `http://localhost` ，尽管它显示无法访问，你只需要复制地址栏中的地址然后粘贴到第二步的输入框里。onedrive-vercel-index 会自动识别用于获取 `access_token` 与 `refresh_token` 的认证码，然后点击 _Get tokens_ 就行。

### 第三步 获取凭证

![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

你只需要等待几秒钟，页面上就会显示成功提示以及几行凭证，请点击 _Store tokens_ ，你的凭证就会保存到 Redis 数据库里。

*📢这个过程中我们一直在检查 **你的身份** ，所以如果出现了 "Don't pretend to be the site owner" 提示，请检查 `config/site.config.js` 里的 `userPrincipalName`是否填写正确。*

最后，你将会跳转到你全新的 onedrive-vercel-index ，完成！

> ⚠️如果你认证结束后被重新跳转到步骤一，而你确认一切都没有问题时，**请等待几秒并手动回到主页再刷新**，Redis 数据库存取凭证需要一点儿时间。

## 自定义域名

详情请参考 [Custom Domains - Vercel](https://vercel.com/docs/concepts/projects/custom-domains)。

## 使用密码保护你的文件夹

你可以创建一个需要密码才能访问的文件夹。

### 步骤

*   你需要在 `config/site.json` 的 `protectedRoutes` 处添加要保护的文件夹。
*   在要保护的文件夹下创建一个名为 `.password` 的 **空白文件**。
*   使用任意文本编辑器打开这个 `.password` 文件，并在里面填写该文件夹的访问密码。
*   最后，在 Vercel 中重新部署该项目。

### 设置受密码保护的文件夹

受密码保护的文件夹主要由 `config/site.json` 中的 `protectedRoutes` 属性指定，举个例子 👇

假设你有这样一个文件结构：

```
.
├── 📕 Books
│   └── ...
├── 🌞 Private folder
│   ├── this-is-public
│   └── u-need-a-password   <-- 你想要用密码保护这个文件夹
├── 🍡 Genshin PV
│   └── ...
└── README.md

```

我们想要将 `/u-need-a-password` 设为受密码保护的文件夹，就把它的绝对路径按下列格式填写到 `protectedRoutes` 里：

```
"protectedRoutes": [
  "/🌞 Private folder/u-need-a-password",
],
```

如果你想设置另一个受密码保护的文件夹，那就在下一行按下列格式添加它的绝对路径：

```
"protectedRoutes": [
  "/🌞 Private folder/u-need-a-password",
   "/another/route/for/me/to/protect",
],
```

如果你没有任何受密码保护的文件夹，那么就添加一个 `[]` 以关闭此功能：

```
"protectedRoutes": [],
```

在上述添加的受密码保护的路径的根目录下内创建一个 `.password` 文件，该文件内的纯文本内容就是你访问该文件夹时需要的密码。

![](data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' width='800' height='410'/>)
![](data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)

### 注意事项

是的，所有看起来安全的保护措施都并非无懈可击。

1. 受密码保护的文件夹中的文件直链可以通过 URL 参数 `&odpt=<hashed_token>` 分享，如果你真的需要的话：

   ```
   https://drive.swo.moe/api/raw/?path=/🌞%20Private%20folder/u-need-a-password/watch%20this.mp4&odpt=c8ebdc273d673d167c238dd25a997bdf9b4ecbf589452697c1a6cb416b2ed11d
   ```
   
   我们并不知道这是否会暴露你的密码，受密码保护的文件，个人信息等等，所以请谨慎使用。
   
2. 我个人无法保证此保护功能完全安全。所以我不推荐使用此方式存放你的个人隐私信息，这只是个分享的可选项。

详情请参考 [Password protected routes is now supported #66](https://github.com/spencerwooo/onedrive-vercel-index/discussions/66)。

更新你的项目
------

基本上你的项目是从本项目中分支出去的，详情请参考 [GitHub - Syncing a fork](https://docs.github.com/cn/pull-requests/collaborating-with-pull-requests/working-with-forks/syncing-a-fork)。

### 在网页更新打开你的项目的 GitHub 页面

*   点击 Fetch upstream ，将会出现一个下拉菜单。
*   检查上游的提交细节，没问题的话就点击 Fetch and merge。
*   如果上游的更改与你的项目存在冲突，GitHub 会推荐你开启一个 Pull request 以解决冲突。

### 在命令行更新

将你的项目 Clone 到本地，然后：

```bash
# 拉取上游的更改
git fetch upstream

# 检查你的项目的默认分支（通常是 main）
git checkout main

# 合并上游的更改
git merge upstream/main

# 如果存在冲突，便在本地解决
# 提交更改并推送到 GitHub
git commit -m "xxx"
git push
```

> 文章出处：[Office 365 E5 账号申请及永久续期教程 - LOGI](https://logi.im/script/permanently-keeping-an-office-e5-account.html)
> [onedrive-vercel-index](https://github.com/spencerwooo/onedrive-vercel-index): > [Getting started](https://ovi.swo.moe/docs/getting-started)