function extToMimes(e){let t;switch(e){case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"gif":t="image/gif";break;case"bmp":t="image/bmp";break;case"txt":default:t="text/plain";break;case"xls":case"xlsx":t="application/vnd.ms-excel";break;case"doc":t="application/msword";break;case"pdf":t="application/pdf";break;case"csv":t="text/csv";break;case"mp4":t="video/mp4";break;case"avi":t="video/x-msvideo";break;case"WindowsMediaVideo":t="video/x-ms-wmv";break;case"mov":t="video/quicktime";break;case"flash":t="video/x-flv";break;case"mkv":t="video/x-matroska";break;case"mp3":t="audio/mpeg";break;case"wav":t="audio/wav";break;case"flac":t="audio/flac";break;case"aac":t="audio/aac";break;case"wma":t="audio/x-ms-wma"}return t}function formatFileSize(e){const t=["B","KB","MB","GB","TB","PB","EB","ZB","YB"];let a=e,i=0;for(;a>=1024&&i<t.length-1;)a/=1024,i++;return a=Math.round(100*a)/100,`${a}${t[i]}`}var file_contents={};function cacheDatas(e,t){let a=t.file,i=e.split("/").at(-1),n=extToMimes(i.split(".")[1]);const o=a?a.data.length:0;let c=new ArrayBuffer(o),r=new Uint8Array(c);for(let e=0;e<o;++e)r[e]=a.data[e];let s=new Blob([c],{type:n}),l=formatFileSize(s.size),d={};d.name=i,d.size=l,d.blob=s,file_contents[e]=d}function renderFileDom(e,t){let a=e.querySelector(".file-size"),i=file_contents[t].size;a&&i&&(a.innerHTML=i)}function downloadFile(e){let t=file_contents[e],a=document.createElement("a");a.download=t.name,a.href=URL.createObjectURL(t.blob),document.body.appendChild(a),a.click(),document.body.removeChild(a)}function downloadFileEvent(e){for(let t=0;t<e.length;++t){let a=e[t];const i=ctx.tag_plugins.chat.api+"?type=file&url="||"https://api.vlts.cc/site_info/v1?type=file&url=";new IntersectionObserver(((e,t)=>{utils.requestAnimationFrame((()=>{e.filter((e=>e.isIntersecting)).sort(((e,t)=>e.intersectionRect.y!==t.intersectionRect.y?e.intersectionRect.y-t.intersectionRect.y:e.intersectionRect.x-t.intersectionRect.x)).forEach(((e,n)=>{t.unobserve(e.target),setTimeout((()=>{let t=e.target.getAttribute("url");fetch(i+t).then((function(e){if(e.ok)return e.json();throw new Error("Network response was not ok.")})).then((function(e){cacheDatas(t,e),renderFileDom(a,t)})).catch((function(e){console.log(e)})),a.addEventListener("click",(()=>{downloadFile(t)}))}),Math.max(100,16)*(n+1))}))}))})).observe(a)}}