function fillRoundRect(e,t,a,n,i,l,r){if(2*l>n||2*l>i)return!1;e.save(),e.translate(t,a),drawRoundRectPath(e,n,i,l),e.fillStyle=r||"#000",e.fill(),e.restore()}function strokeRoundRect(e,t,a,n,i,l,r,s){if(2*l>n||2*l>i)return!1;e.save(),e.translate(t,a),drawRoundRectPath(e,n,i,l),e.lineWidth=r||2,e.strokeStyle=s||"#000",e.stroke(),e.restore()}function drawRoundRectPath(e,t,a,n){e.beginPath(0),e.arc(t-n,a-n,n,0,Math.PI/2),e.lineTo(n,a),e.arc(n,a-n,n,Math.PI/2,Math.PI),e.lineTo(0,n),e.arc(n,n,n,Math.PI,3*Math.PI/2),e.lineTo(t-n,0),e.arc(t-n,n,n,3*Math.PI/2,2*Math.PI),e.lineTo(t,a-n),e.closePath()}function fillRoundRectPro(e,t,a,n,i,l,r,s,o,c){if(l+r>n||o+s>n||l+o>i||r+s>i)return!1;e.save(),e.translate(t,a),drawRoundRectPathPro(e,n,i,l,r,s,o),e.fillStyle=c||"#000",e.fill(),e.restore()}function drawRoundRectPathPro(e,t,a,n,i,l,r){e.beginPath(0),e.arc(t-l,a-l,l,0,Math.PI/2),e.lineTo(r,a),e.arc(r,a-r,r,Math.PI/2,Math.PI),e.lineTo(0,n),e.arc(n,n,n,Math.PI,3*Math.PI/2),e.lineTo(t-i,0),e.arc(t-i,i,i,3*Math.PI/2,2*Math.PI),e.lineTo(t,a-l),e.closePath()}function drawWave(e,t,a,n,i){for(let l=0;l<a.length;++l)fillRoundRect(e,4*l,(t-a[l])/2,2,a[l],n,i)}function drawWaveWhenPlaying(e,t,a,n,i,l,r){for(let s=0;s<n.length;++s)4*s+2<=a?fillRoundRect(e,4*s,(t-n[s])/2,2,n[s],i,l):4*s>=a?fillRoundRect(e,4*s,(t-n[s])/2,2,n[s],i,r):a-4*s>=1?(fillRoundRect(e,4*s,(t-n[s])/2,2,n[s],i,r),fillRoundRectPro(e,4*s,(t-n[s])/2,a-4*s,n[s],i,0,0,i,l)):(fillRoundRect(e,4*s,(t-n[s])/2,2,n[s],i,l),fillRoundRectPro(e,4*s,(t-n[s])/2,2-a+4*s,n[s],0,i,i,0,r))}function drawPlayLine(e,t,a,n){fillRoundRect(e,a,0,1,t,.1,n)}function createVoiceDom(e){for(let t=0;t<e.length;++t){let a=e[t];a.loop=!1;a.currentTime;a.classList.contains("qq")?isNaN(a.duration)||a.duration===1/0?a.addEventListener("durationchange",(()=>{createWaveDom(a)})):createWaveDom(a):a.classList.contains("wechat")&&(isNaN(a.duration)||a.duration===1/0?a.addEventListener("durationchange",(()=>{createWechatVoiceDom(a)})):createWechatVoiceDom(a))}}function createWaveDom(e){let t=e.parentElement,a=t.querySelector("canvas");if(a.getContext("2d")){let i=e.duration,l=Math.floor(i),r=l+2>25?25:l+2,s=t.querySelector(".pause-btn"),o=t.querySelector(".play-btn");t.querySelector(".voice-seconds").innerHTML=`${l>60?"..":l}"`;let c=window.devicePixelRatio;a.width=2*(2*r-1)*c,a.height=23*c,a.style.width=2*(2*r-1)+"px",a.style.height="23px";let d=[];for(let e=0;e<r;++e){let e=(Math.floor(51*Math.random())+30)/100*a.height*.8;d.push(e)}var n=a.getContext("2d");n.scale(c,1);let h="#333",u="#999";a.classList.contains("right")&&(h="#ffffff",u="#1373b3"),"dark"===utils.dark.mode&&(h="#ccc",u="#707070",a.classList.contains("right")&&(h="#fff9",u="#6797b780"));let f=!1;drawWave(n,a.height,d,1,h),e.addEventListener("timeupdate",(()=>{e.currentTime>0&&("dark"===utils.dark.mode?(h="#ccc",u="#707070",a.classList.contains("right")&&(h="#fff9",u="#6797b780")):(h="#333",u="#999",a.classList.contains("right")&&(h="#ffffff",u="#1373b3")),utils.requestAnimationFrame((()=>{n.clearRect(0,0,a.width,a.height),drawWaveWhenPlaying(n,a.height,e.currentTime/e.duration*a.width/c,d,1,h,u),drawPlayLine(n,a.height,e.currentTime/e.duration/c*a.width,h)})))})),e.addEventListener("ended",(()=>{e.pause(),s.style.display="none",o.style.display="flex",e.currentTime=0,utils.requestAnimationFrame((()=>{n.clearRect(0,0,a.width,a.height),drawWave(n,a.height,d,1,h)})),f=!1})),t.addEventListener("click",(()=>{"flex"===s.style.display?(e.pause(),s.style.display="none",o.style.display="flex",f=!1):(e.play(),s.style.display="flex",o.style.display="none",f=!0)})),utils.dark.push((function(){f||("dark"===utils.dark.mode?(h="#ccc",u="#707070",a.classList.contains("right")&&(h="#fff9",u="#6797b780")):(h="#333",u="#999",a.classList.contains("right")&&(h="#ffffff",u="#1373b3")),e.currentTime>0?utils.requestAnimationFrame((()=>{n.clearRect(0,0,a.width,a.height),drawWaveWhenPlaying(n,a.height,e.currentTime/e.duration*a.width/c,d,1,h,u),drawPlayLine(n,a.height,e.currentTime/e.duration/c*a.width,h)})):utils.requestAnimationFrame((()=>{n.clearRect(0,0,a.width,a.height),drawWave(n,a.height,d,1,h)})))}))}else console.log("浏览器不支持canvas")}function createCssStyle(e,t){let a=e.duration,n=Math.floor(a),i=n+2>25?25:n+2,l=e.parentElement,r=l.querySelector(".pause-btn"),s=l.querySelector(".play-btn");l.querySelector(".voice-seconds").innerHTML=`${n>60?"..":n}"`;let o=2*(2*i-1);n+2>25&&(l.style.width="100%");let c=document.createElement("div"),d=document.createElement("div");d.className="play-line",c.append(d),c.className=`voice-wave voice-wave-${t+1}`;for(let e=0;e<i;e++){let e=document.createElement("span");e.className="voice-wave-item",c.append(e)}l.insertBefore(c,l.querySelector(".voice-metas")),e.addEventListener("ended",(()=>{e.pause(),r.style.display="none",s.style.display="flex",e.currentTime=0,d.classList.remove("active"),d.classList.add("back")})),l.addEventListener("click",(()=>{"flex"===r.style.display?(e.pause(),r.style.display="none",s.style.display="flex",e.currentTime=0,d.classList.remove("active"),d.classList.add("back")):(e.play(),r.style.display="flex",s.style.display="none",d.classList.add("active"),d.classList.remove("back"))}));let h=`\n    .voice-wave.voice-wave-${t+1}>.play-line {\n        transition: transform ${a}s linear;\n        -moz-transition: transform ${a}s linear;\n        -webkit-transition: transform ${a}s linear;\n        -o-transition: transform ${a}s linear;\n    }\n    .voice-wave.voice-wave-${t+1}>.play-line.active {\n        transform: translateX(${o}px);\n    }\n    `;for(let e=0;e<i;++e)h+=`\n        .voice-wave-${t+1} span.voice-wave-item:nth-child(${e+1}) {\n            height: ${10*(Math.floor(8*Math.random())+3)}%;\n            margin-left: ${0==e?0:2}px;\n        }\n        `;let u=document.createElement("style");u.setAttribute("type","text/css"),u.innerHTML=h,document.getElementsByTagName("head").item(0).appendChild(u)}function createWechatVoiceDom(e){let t=e.parentElement,a=t.querySelector(".wechat-voice"),n=e.duration,i=Math.floor(n);t.querySelector(".voice-seconds").innerHTML=`${i>60?"..":i}"`,t.querySelector(".voice-placeholder").style.width=2*i+"px";let l=!1;e.addEventListener("ended",(()=>{e.pause(),a.classList.remove("play"),e.currentTime=0,l=!1})),t.addEventListener("click",(()=>{l?(e.pause(),a.classList.remove("play"),l=!1):(e.play(),a.classList.add("play"),l=!0)}))}