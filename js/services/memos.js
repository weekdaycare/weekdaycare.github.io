utils.jq((()=>{$((function(){Array.from(document.getElementsByClassName("ds-memos")).forEach((t=>{const s=t.hasAttribute("lazyload");util.viewportLazyload(t,(async()=>{const s=t.getAttribute("api");if(!s)return;const a=t.getAttribute("avatar")||def.avatar,i=t.getAttribute("limit"),r=s.match(/https:\/\/(.*?)\/(.*)/i)[1];utils.request(t,s,(async s=>{let n=e.identify(s);if("feature"===n.version)return;const l=t.getAttribute("user")?.split(",")||[],u=t.getAttribute("hide")?.split(",")||[];await Promise.all(n.data.slice(0,i||n.data.length).map((s=>async function(t,s,a,i,r,n){const l=e[s.version]||e.feature;return`<div class="timenode">\n                      <div class="header">${a.length||i.includes("user")?"":await l.buildUser(t,s,r)}\n                      <span>${l.buildDate(t).toLocaleString()}</span></div>\n                      <div class="body">${marked.parse(t.content||"")}\n                      <div class="tag-plugin image">${l.buildImages(t,n).join("")}</div>\n                      </div></div>`}(s,n,l,u,a,r).then((e=>$(t).append(e))))))}))}),s)}));const e={"22-":{buildUser:async(e,t,s)=>`<div class="user-info">${s?`<img src="${s}">`:""}<span>${e.creatorName}</span></div>`,buildDate:e=>new Date(1e3*e.createdTs),buildImages:(e,t)=>(e.resourceList||[]).filter((e=>e.type?.includes("image/"))).map((e=>`<div class="image-bg"><img src="${e.externalLink||`https://${t}/o/r/${e.id}`}"></div>`))},"22+":{buildUser:async(e,t,s)=>{const a=e?.creator.split("/")[1];let i=t.users.find((e=>e.id===parseInt(a)));i||(t.requests[a]||(t.requests[a]=fetch(`${t.site}/api/v1/users/${a}`).then((e=>e.json())).then((e=>{e.username?(i=e,t.users.push(e)):i=null})).finally((()=>delete t.requests[a]))),await t.requests[a],i=t.users.find((e=>e.id===parseInt(a))));const r=i?i.nickname||i.username:"memos",n=i?.avatarUrl?`${t.site}${i.avatarUrl}`:s||"";return`<div class="user-info">${n?`<img src="${n}">`:""}<span>${r}</span></div>`},buildDate:e=>new Date(e.createTime),buildImages:e=>(e.resources||[]).filter((e=>e.type?.includes("image/"))).map((e=>`<div class="image-bg"><img src="${e.externalLink||`https://${host}/o/r/${e.id}`}"></div>`))},feature:{buildUser:async()=>"memos",buildDate:()=>new Date,buildImages:()=>[]},identify:e=>{let t={version:"feature",users:[],site:api.split("/api/v1")[0],requests:{},data:[]};return Array.isArray(e)?(t.version="22-",t.data=e):e.memos?(t.version="22+",t.data=e.memos):(t.version="feature",console.log("当前Memos版本过高，请到Stellar社区反馈")),t}}}))}));